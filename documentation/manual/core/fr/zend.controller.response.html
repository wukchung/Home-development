<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>Objet de r&eacute;ponse - Zend Framework Manual</title>

</head>
<body>
<table width="100%">
    <tr valign="top">
        <td width="85%">
            <table width="100%">
                <tr>
                    <td width="25%" style="text-align: left;">
                    <a href="zend.controller.actionhelpers.html">Aides d'action (Helper)</a>
                    </td>

                    <td width="50%" style="text-align: center;">
                        <div class="up"><span class="up"><a href="zend.controller.html">Zend_Controller</a></span><br />
                        <span class="home"><a href="manual.html">Programmer's Reference Guide</a></span></div>
                    </td>

                    <td width="25%" style="text-align: right;">
                        <div class="next" style="text-align: right; float: right;"><a href="zend.controller.plugins.html">Plugins</a></div>
                    </td>
                </tr>
            </table>
<hr />
<div id="zend.controller.response" class="section"><div class="info"><h1 class="title">Objet de réponse</h1></div>
    

    <div class="section" id="zend.controller.response.usage" name="zend.controller.response.usage"><div class="info"><h1 class="title">Utilisation</h1></div>
        

        <p class="para">
            L&#039;objet de réponse équilibre la balance du modèle <acronym class="acronym">MVC</acronym> avec
            <a href="zend.controller.request.html" class="link">l&#039;objet de requête</a>. Son but est de
            collecter du contenu et des en-têtes, afin d&#039;être rendue. De plus, le contrôleur
            frontal passe les exceptions qu&#039;il a rencontré à l&#039;objet de réponse, vous offrant une
            possibilité élégante de les gérer. Ce comportement peut être changé avec
             <span class="methodname">Zend_Controller_Front::throwExceptions(true)</span> :
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">throwExceptions</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            Pour rendre toute la réponse : corps et en-têtes, utilisez
             <span class="methodname">sendResponse()</span>.
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">sendResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <blockquote><p><b class="note">Note</b>: 
            
                Par défaut le contrôleur frontal appelle  <span class="methodname">sendResponse()</span> lorsque
                la distribution est terminée. Vous pouvez changer ce comportement avec
                 <span class="methodname">Zend_Controller_Front::returnResponse(true)</span> :
            <br />

            <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">returnResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span> = <span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">dispatch</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// opérations, comme une historisation...</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// et rendu de la réponse:</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">sendResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>

        </p></blockquote>

        <p class="para">
            Vous ne devriez pas afficher du contenu directement dans un contrôleur. Empiler
            plutôt les affichages dans l&#039;objet de réponse :
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// Dans une action d'un contrôleur:</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$this</span>-&gt;<span style="color: #006600;">getResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; -&gt;<span style="color: #006600;">setHeader</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'Content-Type'</span>, <span style="color: #ff0000;">'text/html'</span><span style="color: #66cc66;">&#41;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; -&gt;<span style="color: #006600;">appendBody</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$content</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            Grâce à cela, tous les en-têtes sont envoyés d&#039;un coup, juste avant l&#039;affichage
            du contenu.
        </p>

        <blockquote><p><b class="note">Note</b>: 
            
                Si vous utilisez
                <a href="zend.controller.action.html#zend.controller.action.viewintegration" class="link">des vues dans vos
                action</a>, vous n&#039;avez pas besoin d&#039;ajouter le rendu de la vue dans la réponse,
                car  <span class="methodname">Zend_Controller_Action::render()</span> le fait par
                défaut.
            <br />
        </p></blockquote>

        <p class="para">
            Si une exception est ajoutée par le contrôleur frontal à la réponse, utilisez
             <span class="methodname">isException()</span> pour vérifier ceci, et récupérez les exceptions avec
             <span class="methodname">getException()</span>. Vous pourriez par exemple créer un objet de réponse
            d&#039;erreur, comme un 404, et journaliser l&#039;exception, etc.
        </p>

        <p class="para">
            Pour prendre la main sur l&#039;objet de réponse, demandez le au contrôleur frontal
            via un accesseur, ou commandez lui de vous retourner la celle-ci lors après la
            distribution.
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// récupère la réponse après distribution et affichage:</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">dispatch</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span> = <span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">getResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #b1b100;">if</span> <span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">isException</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #808080; font-style: italic;">// log, mail, etc...</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// Demande au contrôleur frontal de ne pas afficher, mais retourner :</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">returnResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span> = <span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">dispatch</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// du code ici</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// enfin, affichage:</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">sendResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            Par défaut, les messages d&#039;exceptions ne sont pas affichés. Utilisez
             <span class="methodname">renderExceptions()</span> si vous le voulez. Aussi, vous pouvez activer leur
            rendu grâce à Zend_Controller_Front::throwExceptions() :
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">renderExceptions</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">dispatch</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$request</span>, <span style="color: #0000ff;">$response</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// ou:</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">returnResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span> = <span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">dispatch</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">renderExceptions</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">sendResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// ou:</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">throwExceptions</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">dispatch</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


    </div>

    <div class="section" id="zend.controller.response.headers" name="zend.controller.response.headers"><div class="info"><h1 class="title">Manipulation des en-têtes</h1></div>
        

        <p class="para">
            Comme nous l&#039;avons vu, un des rôles de l&#039;objet de réponse est de gérer les
            en-têtes <acronym class="acronym">HTTP</acronym>. Une variété de méthodes permet de contrôler cette gestion :
        </p>

        <ul class="itemizedlist">
            <li class="listitem">
                <p class="para">
                     <span class="methodname">canSendHeaders($throw = false)</span> est utilisée pour déterminer
                    si les en-têtes n&#039;ont pas déjà été envoyés. Si le paramètre optionnel
                    <var class="varname">$throw</var> est à <b><tt>TRUE</tt></b>, alors une exception sera envoyée
                    si c&#039;est le cas. L&#039;attribut <code class="code">headersSentThrowsException</code> permet
                    aussi de gérer ce comportement.
                </p>
            </li>
            <li class="listitem">
                <p class="para">
                     <span class="methodname">setHeader($name, $value, $replace = false)</span> est utilisée pour
                    affecter un en-tête unique. Par défaut, il n&#039;écrase un éventuel précédent du
                    même nom, sauf si <var class="varname">$replace</var> est mis à <b><tt>TRUE</tt></b>.
                </p>
                <p class="para">
                    Avant d&#039;affecter un en-tête, cette méthode utilise
                     <span class="methodname">canSendHeaders()</span> pour voir si à ce point l&#039;en-tête peut être
                    envoyé.
                </p>
            </li>
            <li class="listitem">
                <p class="para">
                     <span class="methodname">setRedirect($url, $code = 302)</span> envoie un en-tête <acronym class="acronym">HTTP</acronym>
                    Location indiquant une redirection. Si un code de statut est passé, il sera
                    utilisé.
                </p>
                <p class="para">
                    En interne, cette méthode appelle  <span class="methodname">setHeader()</span> avec
                    <var class="varname">$replace</var> à <b><tt>TRUE</tt></b>, pour s&#039;assurer de l&#039;unicité de cet
                    en-tête.
                </p>
            </li>
            <li class="listitem">
                <p class="para">
                     <span class="methodname">getHeaders()</span> retourne un tableau contenant tous les
                    en-têtes. Chaque élément est un tableau &quot;nom&quot; &#039;valeur.
                </p>
            </li>
            <li class="listitem">
                <p class="para"> <span class="methodname">clearHeaders()</span> efface tous les en-têtes enregistrés.</p>
            </li>
            <li class="listitem">
                <p class="para">
                     <span class="methodname">setRawHeader()</span> s&#039;utilise pour affecter un en-tête brut,
                    n&#039;utilisant pas la syntaxe clé/valeur, comme un statut.
                </p>
            </li>
            <li class="listitem">
                <p class="para">
                     <span class="methodname">getRawHeaders()</span> retourne tous les en-têtes bruts
                    enregistrés.
                </p>
            </li>
            <li class="listitem">
                <p class="para">
                     <span class="methodname">clearRawHeaders()</span> efface tous les en-têtes bruts
                    enregistrés.
                </p>
            </li>
            <li class="listitem">
                <p class="para">
                     <span class="methodname">clearAllHeaders()</span> efface tous les en-têtes bruts et
                    réguliers enregistrés.
                </p>
            </li>
        </ul>

        <p class="para">
            De plus, des accesseurs spéciaux sont disponibles pour manipuler le code de
            réponse <acronym class="acronym">HTTP</acronym> :  <span class="methodname">setHttpResponseCode()</span> et
             <span class="methodname">getHttpResponseCode()</span>.
        </p>
    </div>

    <div class="section" id="zend.controller.response.namedsegments" name="zend.controller.response.namedsegments"><div class="info"><h1 class="title">Segments nommés</h1></div>
        

        <p class="para">
            L&#039;objet de réponse propose une fragmentation par segments. Ceci permet de séparer
            le corps de la réponse dans plusieurs segments réceptacles, que vous pouvez afficher
            dans un ordre précis. En interne, il s&#039;agit d&#039;un tableau namespacé qui dispose de
            méthodes de manipulation.
        </p>

        <p class="para">
            Par exemple, vous pourriez utiliser l&#039;évènement  <span class="methodname">preDispatch()</span> pour
            rajouter un bandeau de header au corps de la réponse, et l&#039;évènement
             <span class="methodname">postDispatch()</span> pour en ajouter un bandeau de footer :
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// Considérons ce plugin comme étant enregistré</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// auprès du contrôleur frontal</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #000000; font-weight: bold;">class</span> MyPlugin <span style="color: #000000; font-weight: bold;">extends</span> Zend_Controller_Plugin_Abstract</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> preDispatch<span style="color: #66cc66;">&#40;</span>Zend_Controller_Request_Abstract <span style="color: #0000ff;">$request</span><span style="color: #66cc66;">&#41;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$response</span> = <span style="color: #0000ff;">$this</span>-&gt;<span style="color: #006600;">getResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$view</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_View<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$view</span>-&gt;<span style="color: #006600;">setBasePath</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'../views/scripts'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">prepend</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'header'</span>, <span style="color: #0000ff;">$view</span>-&gt;<span style="color: #006600;">render</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'header.phtml'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> postDispatch<span style="color: #66cc66;">&#40;</span>Zend_Controller_Request_Abstract <span style="color: #0000ff;">$request</span><span style="color: #66cc66;">&#41;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$response</span> = <span style="color: #0000ff;">$this</span>-&gt;<span style="color: #006600;">getResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$view</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_View<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$view</span>-&gt;<span style="color: #006600;">setBasePath</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'../views/scripts'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">append</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'footer'</span>, <span style="color: #0000ff;">$view</span>-&gt;<span style="color: #006600;">render</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'footer.phtml'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// un contrôleur d'action</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #000000; font-weight: bold;">class</span> MyController <span style="color: #000000; font-weight: bold;">extends</span> Zend_Controller_Action</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> fooAction<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$this</span>-&gt;<span style="color: #006600;">render</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#125;</span></div></li></ol></div></div></div>


        <p class="para">
            Un appel à <code class="code">/my/foo</code> dans ce cas là, générera un objet de réponse
            ressemblant à ceci :
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">&#40;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #ff0000;">'header'</span>&nbsp; =&gt; ..., <span style="color: #808080; font-style: italic;">// contenu du segment header</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #ff0000;">'default'</span> =&gt; ..., <span style="color: #808080; font-style: italic;">// corps, contenu de MyController::fooAction()</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #ff0000;">'footer'</span>&nbsp; =&gt; ...&nbsp; <span style="color: #808080; font-style: italic;">// contenu du segment footer</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            Lorsque ceci est rendu, ça l&#039;est dans l&#039;ordre dans lequel les segments sont
            rangés dans la réponse.
        </p>

        <p class="para">
            Voici quelques méthodes permettant de manipuler les segments de la
            réponse :
        </p>

        <ul class="itemizedlist">
            <li class="listitem">
                <p class="para">
                     <span class="methodname">setBody()</span> et  <span class="methodname">appendBody()</span> effacent et écrivent,
                    ou rajoutent un contenu à un segment qu&#039;on leur indique en deuxième paramètre
                    (<var class="varname">$name</var>). Si celui-ci n&#039;existe pas, il sera crée en fin de pile. Si
                    le paramètre segment n&#039;est pas défini, alors le segment &quot;default&quot;est
                    utilisé.
                </p>
            </li>
            <li class="listitem">
                <p class="para">
                     <span class="methodname">prepend($name, $content)</span> va créer un segment appelé
                    <var class="varname">$name</var> et le placé au début du tableau. Si le segment existe, il
                    sera écrasé.
                </p>
            </li>
            <li class="listitem">
                <p class="para">
                     <span class="methodname">append($name, $content)</span> va créer un segment appelé
                    <var class="varname">$name</var> et le placer à la fin du tableau. Si le segment existe, il
                    sera écrasé.
                </p>
            </li>
            <li class="listitem">
                <p class="para">
                     <span class="methodname">insert($name, $content, $parent = null, $before = false)</span> va
                    créer un segment appelé <var class="varname">$name</var>. Si <var class="varname">$parent</var> est
                    renseigné, le nouveau segment sera placé avant ou après le segment
                    <var class="varname">$parent</var>, ceci dépendant de la valeur de <var class="varname">$before</var>. Si
                    le segment existe, il sera écrasé.
                </p>
            </li>
            <li class="listitem">
                <p class="para">
                     <span class="methodname">clearBody($name = null)</span> va vider le contenu du segment qui
                    lui est passé en paramètre via <var class="varname">$name</var>. Par défaut, il vide tout le
                    tableau (détruit tous les segments).
                </p>
            </li>
            <li class="listitem">
                <p class="para">
                     <span class="methodname">getBody($spec = false)</span> retourne le contenu du segment
                    <var class="varname">$spec</var>. Si <var class="varname">$spec</var> vaut <b><tt>FALSE</tt></b>, il retourne
                    le contenu de tous les segments. Si <b><tt>TRUE</tt></b>, c&#039;est le tableau de
                    segments qui est retourné.
                </p>
            </li>
        </ul>
    </div>

    <div class="section" id="zend.controller.response.exceptions" name="zend.controller.response.exceptions"><div class="info"><h1 class="title">Manipulation des exceptions dans l&#039;objet de réponse</h1></div>
        

        <p class="para">
            Comme déjà mentionné, par défaut, les exceptions rencontrées durant le processus
            <acronym class="acronym">MVC</acronym> de distribution, sont ajoutées à l&#039;objet de réponse. Elles le sont dans une pile,
            ce qui vous permet de toutes les garder -- les exceptions d&#039;application, les exceptions
            de distribution, les exceptions de plugin -- etc... Si vous voulez manipuler finement
            celles-ci, voyez plutôt les méthodes ci-après :
        </p>

        <ul class="itemizedlist">
            <li class="listitem">
                <p class="para"> <span class="methodname">setException(Exception $e)</span> enregistre une exception.</p>
            </li>
            <li class="listitem">
                <p class="para">
                     <span class="methodname">isException()</span> est utilisée pour déterminer si il existe au
                    moins une exception.
                </p>
            </li>
            <li class="listitem">
                <p class="para">
                     <span class="methodname">getException()</span> retourne toutes les exceptions sous forme de
                    tableau.
                </p>
            </li>
            <li class="listitem">
                <p class="para">
                     <span class="methodname">hasExceptionOfType($type)</span> sert à déterminer si des
                    exceptions d&#039;une classe spécifique existent.
                </p>
            </li>
            <li class="listitem">
                <p class="para">
                     <span class="methodname">hasExceptionOfMessage($message)</span> sert à déterminer si des
                    exceptions ayant un message spécifique existent.
                </p>
            </li>
            <li class="listitem">
                <p class="para">
                     <span class="methodname">hasExceptionOfCode($code)</span> sert à déterminer si des
                    exceptions ayant un code spécifique existent.
                </p>
            </li>
            <li class="listitem">
                <p class="para">
                     <span class="methodname">getExceptionByType($type)</span> retourne toutes les exceptions
                    d&#039;une classe spécifique. Un tableau est retourné, ou <b><tt>FALSE</tt></b> si
                    aucun exception ne correspond
                </p>
            </li>
            <li class="listitem">
                <p class="para">
                     <span class="methodname">getExceptionByMessage($message)</span> retourne toutes les
                    exceptions ayant un message spécifique. Un tableau est retourné, ou
                    <b><tt>FALSE</tt></b> si aucun exception ne correspond
                </p>
            </li>
            <li class="listitem">
                <p class="para">
                     <span class="methodname">getExceptionByCode($code)</span> retourne toutes les exceptions
                    ayant un code spécifique. Un tableau est retourné, ou <b><tt>FALSE</tt></b> si
                    aucun exception ne correspond.
                </p>
            </li>
            <li class="listitem">
                <p class="para">
                     <span class="methodname">renderExceptions($flag)</span> vous permet de définir si les
                    exceptions doivent être envoyées lorsque la réponse est rendue.
                </p>
            </li>
        </ul>
    </div>

    <div class="section" id="zend.controller.response.subclassing" name="zend.controller.response.subclassing"><div class="info"><h1 class="title">Dériver l&#039;objet de réponse</h1></div>
        

        <p class="para">
            L&#039;objet de réponse sert à collecter les en-têtes <acronym class="acronym">HTTP</acronym> de la réponse, ainsi que
            son contenu, depuis le système <acronym class="acronym">MVC</acronym> mais aussi de l&#039;afficher au client. De plus, l&#039;objet
            collecte les exceptions et permet de les gérer, de les retourner, ou de les garder sous
            silence.
        </p>

        <p class="para">
            La classe de base est <span class="classname">Zend_Controller_Response_Abstract</span>,
            et toute dérivation devra en hériter directement ou indirectement. Les méthodes qu&#039;elle
            propose ont été vues dans les sections précédentes.
        </p>

        <p class="para">
            Vous pouvez dériver l&#039;objet de réponse pour plusieurs raisons, incluant la
            volonté de modifier le retour de la sortie, pour ne pas envoyer d&#039;en-têtes dans un
            environnement de requête CLI ou <acronym class="acronym">PHP</acronym>-GTK, la gestion de templates, etc.
        </p>
    </div>
</div>
        <hr />

            <table width="100%">
                <tr>
                    <td width="25%" style="text-align: left;">
                    <a href="zend.controller.actionhelpers.html">Aides d'action (Helper)</a>
                    </td>

                    <td width="50%" style="text-align: center;">
                        <div class="up"><span class="up"><a href="zend.controller.html">Zend_Controller</a></span><br />
                        <span class="home"><a href="manual.html">Programmer's Reference Guide</a></span></div>
                    </td>

                    <td width="25%" style="text-align: right;">
                        <div class="next" style="text-align: right; float: right;"><a href="zend.controller.plugins.html">Plugins</a></div>
                    </td>
                </tr>
            </table>
</td>
        <td style="font-size: smaller;" width="15%"> <style type="text/css">
#leftbar {
	float: left;
	width: 186px;
	padding: 5px;
	font-size: smaller;
}
ul.toc {
	margin: 0px 5px 5px 5px;
	padding: 0px;
}
ul.toc li {
	font-size: 85%;
	margin: 1px 0 1px 1px;
	padding: 1px 0 1px 11px;
	list-style-type: none;
	background-repeat: no-repeat;
	background-position: center left;
}
ul.toc li.header {
	font-size: 115%;
	padding: 5px 0px 5px 11px;
	border-bottom: 1px solid #cccccc;
	margin-bottom: 5px;
}
ul.toc li.active {
	font-weight: bold;
}
ul.toc li a {
	text-decoration: none;
}
ul.toc li a:hover {
	text-decoration: underline;
}
</style>
 <ul class="toc">
  <li class="header home"><a href="manual.html">Programmer's Reference Guide</a></li>
  <li class="header up"><a href="manual.html">Programmer's Reference Guide</a></li>
  <li class="header up"><a href="reference.html">Zend Framework Reference</a></li>
  <li class="header up"><a href="zend.controller.html">Zend_Controller</a></li>
  <li><a href="zend.controller.quickstart.html">Zend_Controller - D&eacute;marrage rapide</a></li>
  <li><a href="zend.controller.basics.html">Fondations de Zend_Controller</a></li>
  <li><a href="zend.controller.front.html">Le contr&ocirc;leur frontal (Front Controller)</a></li>
  <li><a href="zend.controller.request.html">L'objet Requ&ecirc;te</a></li>
  <li><a href="zend.controller.router.html">Routeur Standard</a></li>
  <li><a href="zend.controller.dispatcher.html">Le distributeur</a></li>
  <li><a href="zend.controller.action.html">Contr&ocirc;leurs d'action</a></li>
  <li><a href="zend.controller.actionhelpers.html">Aides d'action (Helper)</a></li>
  <li class="active"><a href="zend.controller.response.html">Objet de r&eacute;ponse</a></li>
  <li><a href="zend.controller.plugins.html">Plugins</a></li>
  <li><a href="zend.controller.modular.html">Utilisation de conventions de dossiers modulaires</a></li>
  <li><a href="zend.controller.exceptions.html">Exceptions avec MVC</a></li>
 </ul>
 </td>
    </tr>
</table>
</body>
</html>