<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>Zend_XmlRpc_Client - Zend Framework Manual</title>

</head>
<body>
<table width="100%">
    <tr valign="top">
        <td width="85%">
            <table width="100%">
                <tr>
                    <td width="25%" style="text-align: left;">
                    <a href="zend.xmlrpc.introduction.html">Введение</a>
                    </td>

                    <td width="50%" style="text-align: center;">
                        <div class="up"><span class="up"><a href="zend.xmlrpc.html">Zend_XmlRpc</a></span><br />
                        <span class="home"><a href="manual.html">Programmer's Reference Guide</a></span></div>
                    </td>

                    <td width="25%" style="text-align: right;">
                        <div class="next" style="text-align: right; float: right;"><a href="zend.xmlrpc.server.html">Zend_XmlRpc_Server</a></div>
                    </td>
                </tr>
            </table>
<hr />
<div id="zend.xmlrpc.client" class="section"><div class="info"><h1 class="title">Zend_XmlRpc_Client</h1></div>
    

    <div class="section" id="zend.xmlrpc.client.introduction" name="zend.xmlrpc.client.introduction"><div class="info"><h1 class="title">Введение</h1></div>
        

        <p class="para">
            Zend Framework поддерживает клиентское использование удаленных
            XML-RPC сервисов через пакет <span class="classname">Zend_XmlRpc_Client</span>.
            Его основные возможности включают в себя автоматическое
            преобразование типов между PHP и XML-RPC, прокси-объект сервера и
            доступ к средствам интроспекции на сервере.
        </p>

    </div>


    <div class="section" id="zend.xmlrpc.client.method-calls" name="zend.xmlrpc.client.method-calls"><div class="info"><h1 class="title">Вызов методов</h1></div>
        

        <p class="para">
            Конструктор <span class="classname">Zend_XmlRpc_Client</span> принимает URL удаленного
            XML-RPC сервера в качестве первого параметра. Новый экземпляр класса
            может использоваться для вызова любых удаленных методов этого
            сервера.
        </p>

        <p class="para">
            Для вызова удаленного метода через клиентa XML-RPC инстанцируйте его
            и используйте его метод <code class="code">call()</code>. В примере ниже
            используется демонстрационный XML-RPC сервер на веб-сайте Zend
            Framework. Вы можете использовать его для тестирования или изучения
            компонент <span class="classname">Zend_XmlRpc</span>.
        </p>

        <div class="example"><div class="info"><p><b>Example #1 Вызов метода XML-RPC</b></p></div>
            
            <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$client</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_XmlRpc_Client<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'http://framework.zend.com/xmlrpc'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/echo"><span style="color: #000066;">echo</span></a> <span style="color: #0000ff;">$client</span>-&gt;<span style="color: #006600;">call</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'test.sayHello'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// hello</span></div></li></ol></div></div></div>

        </div>

        <p class="para">
            Значение XML-RPC, возвращаемое при вызове удаленного метода, будет
            автоматически приведено к эквивалентному типу в PHP. В примере выше
            возвращается строка (тип  <span class="type">String</span>  в PHP), и она уже
            готова к применению.
        </p>

        <p class="para">
            Первый параметр метода <code class="code">call()</code> принимает имя удаленного
            метода, вызов которого требуется. Если удаленный метод требует
            каких-либо параметров, то они могут быть переданы методу
            <code class="code">call()</code> через второй необязательный параметр в виде
            массива значений для последующей передачи удаленному методу:
        </p>

        <div class="example"><div class="info"><p><b>Example #2 Вызов метода XML-RPC с параметрами</b></p></div>
            
            <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$client</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_XmlRpc_Client<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'http://framework.zend.com/xmlrpc'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$arg1</span> = <span style="color: #cc66cc;">1.1</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$arg2</span> = <span style="color: #ff0000;">'foo'</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$result</span> = <span style="color: #0000ff;">$client</span>-&gt;<span style="color: #006600;">call</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'test.sayHello'</span>, <a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$arg1</span>, <span style="color: #0000ff;">$arg2</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// возвращаемый результат имеет &quot;родной&quot; для PHP тип</span></div></li></ol></div></div></div>

        </div>

        <p class="para">
            Если удаленный метод не требует параметров, то этот необязательный
            параметр можно опустить или передать пустой массив. Массив
            параметров для удаленного метода может содержать значения &quot;родного&quot;
            для PHP типа, объекты <span class="classname">Zend_XmlRpc_Value</span>, либо
            и то и другое вместе.
        </p>

        <p class="para">
            Метод <code class="code">call()</code> будет автоматически преобразовывать ответ
            XML-RPC и возвращать его в эквивалентном &quot;родном&quot; для PHP типе.
            Кроме этого, можно получить объект <span class="classname">Zend_XmlRpc_Response</span>
            для возвращенного значения, вызвав метод
            <code class="code">getLastResponse()</code> после вызова <code class="code">call()</code>.
        </p>
    </div>

    <div class="section" id="zend.xmlrpc.value.parameters" name="zend.xmlrpc.value.parameters"><div class="info"><h1 class="title">Типы и их преобразование</h1></div>
        
        <p class="para">
            Некоторые удаленные методы требуют передачи параметров при вызове.
            Они передаются методу <code class="code">call()</code> объекта
            <span class="classname">Zend_XmlRpc_Client</span> в виде массива во втором параметре.
            Любой параметр может быть передан в &quot;родном&quot; для PHP типе, который
            будет автоматически преобразован в соответствующий тип XML-RPC,
            или как объект, представляющий
            определенный тип в XML-RPC (один из объектов
            <span class="classname">Zend_XmlRpc_Value</span>).
        </p>

        <div class="section" id="zend.xmlrpc.value.parameters.php-native" name="zend.xmlrpc.value.parameters.php-native"><div class="info"><h1 class="title">Параметры в &quot;родном&quot; для PHP типе</h1></div>
            
            <p class="para">
                Параметры могут передаваться методу <code class="code">call()</code> как
                переменные &quot;родного&quot; для PHP типа, это могут быть типы
                 <span class="type">String</span> , <code class="code">integer</code>, <code class="code">float</code>,
                 <span class="type">Boolean</span> ,  <span class="type">Array</span>  или
                <code class="code">object</code>. В этом случае каждый из этих типов будет
                автоматически определен и преобразован в один из типов XML-RPC
                согласно следующей таблице:
            </p>

            <table class="doctable table"><div class="info"><caption><b>Преобразование типов PHP и XML-RPC</b></caption></div>
                
                
                    <thead valign="middle">
                        <tr valign="middle">
                            <th>Тип в PHP</th>
                            <th>Тип в XML-RPC</th>
                        </tr>

                    </thead>

                    <tbody valign="middle" class="tbody">
                        <tr valign="middle">
                            <td align="left">integer</td>
                            <td align="left">int</td>
                        </tr>

                        <tr valign="middle">
                            <td align="left">double</td>
                            <td align="left">double</td>
                        </tr>

                        <tr valign="middle">
                            <td align="left">boolean</td>
                            <td align="left">boolean</td>
                        </tr>

                        <tr valign="middle">
                            <td align="left">string</td>
                            <td align="left">string</td>
                        </tr>

                        <tr valign="middle">
                            <td align="left">array</td>
                            <td align="left">array</td>
                        </tr>

                        <tr valign="middle">
                            <td align="left">array (ассоциативный)</td>
                            <td align="left">struct</td>
                        </tr>

                        <tr valign="middle">
                            <td align="left">object</td>
                            <td align="left">array</td>
                        </tr>

                    </tbody>
                
            </table>


            <blockquote><p><b class="note">Note</b>: <span class="info"><b>Какому типу будет соответствовать пустой массив?</b><br /></span>
                

                
                    Передача пустого массива методу XML-RPC несет в себе
                    потенциальную проблему, т.к. он может быть представлен
                    и массивом, и структурой. <span class="classname">Zend_XmlRpc_Client</span>
                    в этом случае делает запрос к методу сервера
                    <code class="code">system.methodSignature</code> для определения
                    требуемого типа аргумента и производит соответствующее
                    преобразование.
                <br />

                
                    Но такое решение само по себе тоже может быть источником
                    проблем. Во-первых, сервера, которые не поддерживают метод
                    <code class="code">system.methodSignature</code>, будут журналировать это
                    как ошибочные вызовы, в этом случае
                    <span class="classname">Zend_XmlRpc_Client</span> будет производить
                    преобразование значения к типу array в XML-RPC.
                    Кроме того, это приводит к дополнительным вызовам к
                    удаленному серверу в случае передачи аргументов в виде
                    массивов.
                <br />

                
                    Для того, чтобы полностью отключить эти вызовы, вы можете
                    вызвать метод <code class="code">setSkipSystemLookup()</code> до
                    собственно запроса к методу XML-RPC:
                <br />

                <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$client</span>-&gt;<span style="color: #006600;">setSkipSystemLookup</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$result</span> = <span style="color: #0000ff;">$client</span>-&gt;<span style="color: #006600;">call</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'foo.bar'</span>, <a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">&#40;</span><a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>

            </p></blockquote>

        </div>

        <div class="section" id="zend.xmlrpc.value.parameters.xmlrpc-value" name="zend.xmlrpc.value.parameters.xmlrpc-value"><div class="info"><h1 class="title">Параметры в виде объектов Zend_XmlRpc_Value</h1></div>
            
            <p class="para">
                Параметры могут также создаваться как экземпляры
                <span class="classname">Zend_XmlRpc_Value</span> для точного указания типа
                XML-RPC. Основные причины для этого:

                <ul class="itemizedlist">
                    <li class="listitem">
                        <p class="para">
                            Вы хотите быть уверенными в том, что
                            процедуре передается корректный тип параметра
                            (т.е. процедура требует целочисленное значение, а
                            вы можете получать его из БД в виде
                            строки)
                        </p>
                    </li>
                    <li class="listitem">
                        <p class="para">
                            Удаленная процедура требует тип <code class="code">base64</code>
                            или <code class="code">dateTime.iso8601</code> (которых нет среди
                            &quot;родных&quot; для PHP типов).
                        </p>
                    </li>
                    <li class="listitem">
                        <p class="para">
                            Автоматическое преобразование может работать
                            неправильно (например, вы хотите передать пустую
                            структуру XML-RPC в качестве параметра. Пустая структура
                            представляется в PHP пустым массивом, но если вы
                            передаете пустой массив в качестве параметра, то он
                            преобразовывается в массив XML-RPC, т.к. не
                            является ассоциативным массивом)
                        </p>
                    </li>
                </ul>
            </p>

            <p class="para">
                Есть два способа создания объектов <span class="classname">Zend_XmlRpc_Value</span> ―
                непосредственное инстанцирование одного из подклассов
                <span class="classname">Zend_XmlRpc_Value</span> и использование статического
                фабричного метода
                <span class="classname">Zend_XmlRpc_Value::getXmlRpcValue()</span>.
            </p>

            <table class="doctable table"><div class="info"><caption><b>Объекты Zend_XmlRpc_Value для типов XML-RPC</b></caption></div>
                
                
                    <thead valign="middle">
                        <tr valign="middle">
                            <th>Тип XML-RPC</th>
                            <th>Константа <span class="classname">Zend_XmlRpc_Value</span></th>
                            <th>Объект <span class="classname">Zend_XmlRpc_Value</span></th>
                        </tr>

                    </thead>

                    <tbody valign="middle" class="tbody">
                        <tr valign="middle">
                            <td align="left">int</td>
                            <td align="left"><code class="code">Zend_XmlRpc_Value::XMLRPC_TYPE_INTEGER</code></td>
                            <td align="left"><span class="classname">Zend_XmlRpc_Value_Integer</span></td>
                        </tr>

                        <tr valign="middle">
                            <td align="left">double</td>
                            <td align="left"><code class="code">Zend_XmlRpc_Value::XMLRPC_TYPE_DOUBLE</code></td>
                            <td align="left"><span class="classname">Zend_XmlRpc_Value_Double</span></td>
                        </tr>

                        <tr valign="middle">
                            <td align="left">boolean</td>
                            <td align="left"><code class="code">Zend_XmlRpc_Value::XMLRPC_TYPE_BOOLEAN</code></td>
                            <td align="left"><span class="classname">Zend_XmlRpc_Value_Boolean</span></td>
                        </tr>

                        <tr valign="middle">
                            <td align="left">string</td>
                            <td align="left"><code class="code">Zend_XmlRpc_Value::XMLRPC_TYPE_STRING</code></td>
                            <td align="left"><span class="classname">Zend_XmlRpc_Value_String</span></td>
                        </tr>

                        <tr valign="middle">
                            <td align="left">base64</td>
                            <td align="left"><code class="code">Zend_XmlRpc_Value::XMLRPC_TYPE_BASE64</code></td>
                            <td align="left"><span class="classname">Zend_XmlRpc_Value_Base64</span></td>
                        </tr>

                        <tr valign="middle">
                            <td align="left">dateTime.iso8601</td>
                            <td align="left"><code class="code">Zend_XmlRpc_Value::XMLRPC_TYPE_DATETIME</code></td>
                            <td align="left"><span class="classname">Zend_XmlRpc_Value_DateTime</span></td>
                        </tr>

                        <tr valign="middle">
                            <td align="left">array</td>
                            <td align="left"><code class="code">Zend_XmlRpc_Value::XMLRPC_TYPE_ARRAY</code></td>
                            <td align="left"><span class="classname">Zend_XmlRpc_Value_Array</span></td>
                        </tr>

                        <tr valign="middle">
                            <td align="left">struct</td>
                            <td align="left"><code class="code">Zend_XmlRpc_Value::XMLRPC_TYPE_STRUCT</code></td>
                            <td align="left"><span class="classname">Zend_XmlRpc_Value_Struct</span></td>
                        </tr>

                    </tbody>
                
            </table>


            <p class="para">
                <blockquote><p><b class="note">Note</b>: <span class="info"><b>Автоматическое преобразование</b><br /></span>
                    
                    
                        Когда создается новый объект
                        <span class="classname">Zend_XmlRpc_Value</span>, его значение
                        устанавливается в &quot;родном&quot; для PHP типе. Тип в PHP будет
                        преобразован к определенному типу средствами PHP.
                        Например, если в качестве значения для объекта
                        <span class="classname">Zend_XmlRpc_Value_Integer</span> была передана
                        строка, то она будет преобразована через
                        <code class="code">(int)$value</code>.
                    <br />
                </p></blockquote>
            </p>
        </div>
    </div>

    <div class="section" id="zend.xmlrpc.client.requests-and-responses" name="zend.xmlrpc.client.requests-and-responses"><div class="info"><h1 class="title">Прокси-объект сервера</h1></div>
        
        <p class="para">
            Другим способом вызова удаленных методов через клиента XML-RPC
            является использование &quot;заместителя&quot; сервера. Это PHP-объект,
            который предоставляет интерфейс к удаленному пространству имен
            XML-RPC, делая работу с ним максимально близкой к работе с обычным
            объектом в PHP.
        </p>

        <p class="para">
            Для того, чтобы инстанцировать &quot;заместителя&quot; сервера, вызовите
            метод <code class="code">getProxy()</code> объекта
            <span class="classname">Zend_XmlRpc_Client</span>. Он вернет объект класса
            <span class="classname">Zend_XmlRpc_Client_ServerProxy</span>.
            Любые вызовы методов прокси-объекта
            сервера будет перенаправлены к удаленному серверу, параметры могут
            передаваться так же, как и для любых других методов в PHP.
        </p>

        <div class="example"><div class="info"><p><b>Example #3 Прокси-объект к пространству имен по умолчанию</b></p></div>
            
            <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$client</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_XmlRpc_Client<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'http://framework.zend.com/xmlrpc'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// Создание прокси-объекта к пространству имен по умолчанию</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$server</span> = <span style="color: #0000ff;">$client</span>-&gt;<span style="color: #006600;">getProxy</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$hello</span> = <span style="color: #0000ff;">$server</span>-&gt;<span style="color: #006600;">test</span>-&gt;<span style="color: #006600;">sayHello</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">1</span>, <span style="color: #cc66cc;">2</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// test.Hello(1, 2) возвращает &quot;hello&quot;</span></div></li></ol></div></div></div>

        </div>

        <p class="para">
            Метод <code class="code">getProxy()</code> принимает необязательный аргумент,
            указывающий, к какому пространству имен следует создать
            прокси-объект. Если этот аргумент не был указан, то то будет
            использоваться пространство имен по умолчанию. В следующем примере
            используется пространство имен <code class="code">test</code>:
        </p>

        <div class="example"><div class="info"><p><b>Example #4 Прокси-объект к произвольному пространству имен</b></p></div>
            
            <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$client</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_XmlRpc_Client<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'http://framework.zend.com/xmlrpc'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// Создание прокси-объекта к пространству имен &quot;test&quot;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$test</span>&nbsp; = <span style="color: #0000ff;">$client</span>-&gt;<span style="color: #006600;">getProxy</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'test'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$hello</span> = <span style="color: #0000ff;">$test</span>-&gt;<span style="color: #006600;">sayHello</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">1</span>, <span style="color: #cc66cc;">2</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// test.Hello(1,2) возвращает &quot;hello&quot;</span></div></li></ol></div></div></div>

        </div>

        <p class="para">
            Если удаленный сервер поддерживает сколько угодно вложенные
            пространства имен, то они также могут использоваться через
            прокси-объект сервера. Например, если сервер в примере выше имеет
            метод <code class="code">test.foo.bar()</code>, то он может вызываться следующим
            образом: <var class="varname">$test-&gt;foo-&gt;bar()</var>.
        </p>
    </div>


    <div class="section" id="zend.xmlrpc.client.error-handling" name="zend.xmlrpc.client.error-handling"><div class="info"><h1 class="title">Обработка ошибок</h1></div>
        
        <p class="para">
            При вызове методов XML-RPC могут могут быть ошибки двух типов: HTTP и
            XML-RPC. <span class="classname">Zend_XmlRpc_Client</span> распознает оба типа,
            позволяя обнаруживать и отлавливать их независимо друг от друга.
        </p>

        <div class="section" id="zend.xmlrpc.client.error-handling.http" name="zend.xmlrpc.client.error-handling.http"><div class="info"><h1 class="title">Ошибки HTTP</h1></div>
            

            <p class="para">
                Если произошла ошибка HTTP - например, удаленный HTTP-сервер
                вернул код <code class="code">404 Not Found</code>, - то будет сгенерировано
                исключение <span class="classname">Zend_XmlRpc_Client_HttpException</span>.
            </p>

            <div class="example"><div class="info"><p><b>Example #5 Обработка ошибок HTTP</b></p></div>
                

                <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$client</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_XmlRpc_Client<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'http://foo/404'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">try <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #0000ff;">$client</span>-&gt;<span style="color: #006600;">call</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'bar'</span>, <a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$arg1</span>, <span style="color: #0000ff;">$arg2</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#125;</span> catch <span style="color: #66cc66;">&#40;</span>Zend_XmlRpc_HttpException <span style="color: #0000ff;">$e</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #808080; font-style: italic;">// $e-&gt;getCode() возвращает 404</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #808080; font-style: italic;">// $e-&gt;getMessage() возвращает &quot;Not Found&quot;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#125;</span></div></li></ol></div></div></div>

            </div>

            <p class="para">
                Независимо от того, какой клиент XML-RPC используется, всякий
                раз, когда происходит ошибка HTTP, генерируется исключение
                <span class="classname">Zend_XmlRpc_Client_HttpException</span>.
            </p>
        </div>

        <div class="section" id="zend.xmlrpc.client.error-handling.faults" name="zend.xmlrpc.client.error-handling.faults"><div class="info"><h1 class="title">Ошибки XML-RPC</h1></div>
            

            <p class="para">
                Ошибка XML-RPC аналогична исключению в PHP. Это специальный тип,
                возвращаемый при вызове метода XML-RPC и включающий в себя код и
                сообщение ошибки. Ошибки XML-RPC обрабатываются по-разному,
                в зависимости от контекста использования
                <span class="classname">Zend_XmlRpc_Client</span>.
            </p>

            <p class="para">
               Если используется метод <code class="code">call()</code> или прокси-объект
               сервера, то ошибка XML-RPC приведет к тому, что будет
               сгенерировано исключение
               <span class="classname">Zend_XmlRpc_Client_FaultException</span>. Код и сообщение
               исключения будут в точности соответствовать значениям в
               возвращенном ответе с сообщением об ошибке.
            </p>

            <div class="example"><div class="info"><p><b>Example #6 Обработка ошибок XML-RPC</b></p></div>
                

                <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$client</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_XmlRpc_Client<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'http://framework.zend.com/xmlrpc'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">try <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #0000ff;">$client</span>-&gt;<span style="color: #006600;">call</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'badMethod'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#125;</span> catch <span style="color: #66cc66;">&#40;</span>Zend_XmlRpc_FaultException <span style="color: #0000ff;">$e</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #808080; font-style: italic;">// $e-&gt;getCode() возвращает 1</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #808080; font-style: italic;">// $e-&gt;getMessage() возвращает &quot;Unknown method&quot;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#125;</span></div></li></ol></div></div></div>

            </div>

            <p class="para">
                Если для выполнения запроса используется метод
                <code class="code">call()</code>, то в случае ошибки будет сгенерировано
                исключение <span class="classname">Zend_XmlRpc_FaultException</span>. Объект
                <span class="classname">Zend_XmlRpc_Response</span>, содержащий возвращенную
                ошибку, можно также получить через метод
                <code class="code">getLastResponse()</code>.
            </p>

            <p class="para">
                Если для выполнения запроса используется метод
                <code class="code">doRequest()</code>, то исключение не генерируется. Вместо
                этого будет возвращен объект <span class="classname">Zend_XmlRpc_Response</span>,
                содержащий возвращенную XML-RPC ошибку. Проверить, содержит ли
                объект ошибку, можно через метод <code class="code">isFault()</code> объекта
                <span class="classname">Zend_XmlRpc_Response</span>.
            </p>
        </div>

    </div>

    <div class="section" id="zend.xmlrpc.client.introspection" name="zend.xmlrpc.client.introspection"><div class="info"><h1 class="title">Интроспекция сервера</h1></div>
        
        <p class="para">
            Некоторые XML-RPC сервера поддерживают интроспекцию методов
            под пространством имен <code class="code">system.</code>.
            <span class="classname">Zend_XmlRpc_Client</span> предоставляет специальную поддержку
            для серверов с этой возможностью.
        </p>

        <p class="para">
            Экземпляр <span class="classname">Zend_XmlRpc_Client_ServerIntrospection</span> может
            быть получен через вызов метода <code class="code">getIntrospector()</code>
            класса <span class="classname">Zend_XmlRpcClient</span>. Далее он может использоваться
            для выполнения операций интроспекции на сервере.
        </p>
    </div>

    <div class="section" id="zend.xmlrpc.client.request-to-response" name="zend.xmlrpc.client.request-to-response"><div class="info"><h1 class="title">От запроса к ответу</h1></div>
        
        <p class="para">
            Метод <code class="code">call()</code> экземпляра <span class="classname">Zend_XmlRpc_Client</span>
            в процессе выполнения строит объект запроса
            (<span class="classname">Zend_XmlRpc_Request</span>) и передает его другому методу
            <code class="code">doRequest()</code>, который возвращает объект ответа
            (<span class="classname">Zend_XmlRpc_Response</span>).
        </p>

        <p class="para">
            Метод <code class="code">doRequest()</code> также доступен для непосредственного
            использования:
        </p>

        <div class="example"><div class="info"><p><b>Example #7 Выполнение запроса</b></p></div>
            

            <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$client</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_XmlRpc_Client<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'http://framework.zend.com/xmlrpc'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$request</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_XmlRpc_Request<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$request</span>-&gt;<span style="color: #006600;">setMethod</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'test.sayHello'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$request</span>-&gt;<span style="color: #006600;">setParams</span><span style="color: #66cc66;">&#40;</span><a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'foo'</span>, <span style="color: #ff0000;">'bar'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$client</span>-&gt;<span style="color: #006600;">doRequest</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$request</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// $server-&gt;getLastRequest() возвращает экземпляр Zend_XmlRpc_Request</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// $server-&gt;getLastResponse() возвращает экземпляр Zend_XmlRpc_Response</span></div></li></ol></div></div></div>

        </div>

        <p class="para">
            После того, как через клиента был вызван метод XML-RPC (через
            методы <code class="code">call()</code>, <code class="code">doRequest()</code> или через
            прокси-объект сервера), всегда можно получить объекты последнего запроса и
            ответа на него через методы <code class="code">getLastRequest()</code> и
            <code class="code">getLastResponse()</code> соответственно.
        </p>
    </div>

    <div class="section" id="zend.xmlrpc.client.http-client" name="zend.xmlrpc.client.http-client"><div class="info"><h1 class="title">HTTP-клиент и тестирование</h1></div>
        

        <p class="para">
            Ни в одном из предыдущих примеров не указывался HTTP-клиент. В
            этом случае создается новый экземпляр <span class="classname">Zend_Http_Client</span>
            с настройками по умолчанию и автоматически используется
            клиентом <span class="classname">Zend_XmlRpc_Client</span>.
        </p>

        <p class="para">
            HTTP-клиент может быть получен в любое время через метод
            <code class="code">getHttpClient()</code>. В большинстве случаев достаточно
            использование HTTP-клиента по умолчанию. Тем не менее, метод
            <code class="code">setHttpClient()</code> позволяет установить HTTP-клиент,
            отличный от принятого по умолчанию.
        </p>

        <p class="para">
            <code class="code">setHttpClient()</code> может быть полезен при
            unit-тестировании. При совместном использовании с
            <span class="classname">Zend_Http_Client_Adapter_Test</span> можно имитировать
            удаленные сервисы для тестирования. В качестве примера реализации
            рассмотрите unit-тесты для <span class="classname">Zend_XmlRpc_Client</span>,
            входящие в поставку Zend Framework.
        </p>
    </div>

</div>
        <hr />

            <table width="100%">
                <tr>
                    <td width="25%" style="text-align: left;">
                    <a href="zend.xmlrpc.introduction.html">Введение</a>
                    </td>

                    <td width="50%" style="text-align: center;">
                        <div class="up"><span class="up"><a href="zend.xmlrpc.html">Zend_XmlRpc</a></span><br />
                        <span class="home"><a href="manual.html">Programmer's Reference Guide</a></span></div>
                    </td>

                    <td width="25%" style="text-align: right;">
                        <div class="next" style="text-align: right; float: right;"><a href="zend.xmlrpc.server.html">Zend_XmlRpc_Server</a></div>
                    </td>
                </tr>
            </table>
</td>
        <td style="font-size: smaller;" width="15%"> <style type="text/css">
#leftbar {
	float: left;
	width: 186px;
	padding: 5px;
	font-size: smaller;
}
ul.toc {
	margin: 0px 5px 5px 5px;
	padding: 0px;
}
ul.toc li {
	font-size: 85%;
	margin: 1px 0 1px 1px;
	padding: 1px 0 1px 11px;
	list-style-type: none;
	background-repeat: no-repeat;
	background-position: center left;
}
ul.toc li.header {
	font-size: 115%;
	padding: 5px 0px 5px 11px;
	border-bottom: 1px solid #cccccc;
	margin-bottom: 5px;
}
ul.toc li.active {
	font-weight: bold;
}
ul.toc li a {
	text-decoration: none;
}
ul.toc li a:hover {
	text-decoration: underline;
}
</style>
 <ul class="toc">
  <li class="header home"><a href="manual.html">Programmer's Reference Guide</a></li>
  <li class="header up"><a href="manual.html">Programmer's Reference Guide</a></li>
  <li class="header up"><a href="reference.html">Zend Framework Reference</a></li>
  <li class="header up"><a href="zend.xmlrpc.html">Zend_XmlRpc</a></li>
  <li><a href="zend.xmlrpc.introduction.html">Введение</a></li>
  <li class="active"><a href="zend.xmlrpc.client.html">Zend_XmlRpc_Client</a></li>
  <li><a href="zend.xmlrpc.server.html">Zend_XmlRpc_Server</a></li>
 </ul>
 </td>
    </tr>
</table>
</body>
</html>