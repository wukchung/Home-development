<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>Объект ответа - Zend Framework Manual</title>

</head>
<body>
<table width="100%">
    <tr valign="top">
        <td width="85%">
            <table width="100%">
                <tr>
                    <td width="25%" style="text-align: left;">
                    <a href="zend.controller.actionhelpers.html">Помощники действий</a>
                    </td>

                    <td width="50%" style="text-align: center;">
                        <div class="up"><span class="up"><a href="zend.controller.html">Zend_Controller</a></span><br />
                        <span class="home"><a href="manual.html">Programmer's Reference Guide</a></span></div>
                    </td>

                    <td width="25%" style="text-align: right;">
                        <div class="next" style="text-align: right; float: right;"><a href="zend.controller.plugins.html">Плагины</a></div>
                    </td>
                </tr>
            </table>
<hr />
<div id="zend.controller.response" class="section"><div class="info"><h1 class="title">Объект ответа</h1></div>
    

    <div class="section" id="zend.controller.response.usage" name="zend.controller.response.usage"><div class="info"><h1 class="title">Использование</h1></div>
        

        <p class="para">
            Объект ответа представляет собой логическое продолжение к
            <a href="zend.controller.request.html" class="link">объекту запроса</a>. Его
            назначение — сбор содержимого ответа и/или его заголовков, таким
            образом, они могут возвращаться как одно целое. Кроме этого,
            фронт-контроллер будет передавать любые пойманные исключения объекту
            ответа, позволяя разработчику должным образом обрабатывать
            исключения. Эта возможность может быть отключена установкой
            <code class="code">Zend_Controller_Front::throwExceptions(true)</code>:
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">throwExceptions</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            Для отправки выходных данных, включая заголовки, используйте
            метод <code class="code">sendResponse()</code>.
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">sendResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <blockquote><p><b class="note">Note</b>: 
            
                По умолчанию фронт-контроллер вызывает
                <code class="code">sendResponse()</code>, когда завершает обработку запроса,
                и, скорее всего, вам никогда не потребуется вызывать этот метод.
                Тем не менее, если вы хотите производить манипуляции с ответом
                или использовать его в тестировании, то вы можете отменить
                это поведение посредством установки флага
                <code class="code">returnResponse</code> методом
                <code class="code">Zend_Controller_Front::returnResponse(true)</code>:
            <br />

            <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">returnResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span> = <span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">dispatch</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// производим необходимые манипуляции с данными (например,</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// журналирование), затем отправляем выходные данные:</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">sendResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>

        </p></blockquote>

        <p class="para">
            Разработчики должны использовать объект ответа в своих контроллерах
            действий. Вместо прямого вывода данных и отправки заголовков
            помещайте их в объект ответа:
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// Внутри контроллера действий:</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// Установка заголовка</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$this</span>-&gt;<span style="color: #006600;">getResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; -&gt;<span style="color: #006600;">setHeader</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'Content-Type'</span>, <span style="color: #ff0000;">'text/html'</span><span style="color: #66cc66;">&#41;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; -&gt;<span style="color: #006600;">appendBody</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$content</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            Этим достигается то, что все заголовки будут отправлены
            одновременно, непосредственно до того, как будет отображено
            содержимое ответа.
        </p>

        <blockquote><p><b class="note">Note</b>: 
            
                Если используется
                <a href="zend.controller.action.html#zend.controller.action.viewintegration" class="link">интеграция
                вида</a>, то вам не нужно сохранять результат рендеринга
                скрипта вида в объект ответа, поскольку
                <code class="code">Zend_Controller_Action::render()</code> делает это по
                умолчанию.
            <br />
        </p></blockquote>

        <p class="para">
            На тот случай, когда произошло исключение в приложении, проверяйте
            флаг <code class="code">isException()</code> в объекте ответа и
            извлекайте исключение, используя <code class="code">getException()</code>. Кроме
            этого, можно создать собственные объекты ответа, которые производят
            перенаправление на страницу ошибки, журналируют сообщения
            исключений, должным образом оформляют сообщения исключений
            для среды разработки и т.д.
        </p>

        <p class="para">
            Вы можете извлекать объект ответа после вызова метода dispatch()
            фронт-контроллера или указать фронт-контроллеру, чтобы он возвращал
            объект ответа вместо его вывода.
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// Получение объекта ответа после диспетчеризации:</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">dispatch</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span> = <span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">getResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #b1b100;">if</span> <span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">isException</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #808080; font-style: italic;">// Журналирование, отправка сообщений и т.д</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// Либо метод dispatch() фронт-контроллера возвращает его</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">returnResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span> = <span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">dispatch</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// Производим какие-либо манипуляции...</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// В конце выводим ответ</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">sendResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            По умолчанию сообщения исключений не отображаются. Это поведение
            может быть отменено вызовом метода <code class="code">renderExceptions()</code>
            или включением через метод <code class="code">throwExceptions()</code>
            возможности генерации исключений фронт-контроллером, как показано
            ниже:
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">renderExceptions</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">dispatch</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$request</span>, <span style="color: #0000ff;">$response</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// или:</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">returnResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span> = <span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">dispatch</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">renderExceptions</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">sendResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// или:</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">throwExceptions</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">dispatch</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>

    </div>

    <div class="section" id="zend.controller.response.headers" name="zend.controller.response.headers"><div class="info"><h1 class="title">Управление заголовками</h1></div>
        

        <p class="para">
            Как было замечено ранее, одной из обязанностей объекта ответа
            является сбор и отправка заголовков ответа HTTP. Для этого есть
            различные методы:
        </p>

        <ul class="itemizedlist">
            <li class="listitem">
                <p class="para">
                    <code class="code">canSendHeaders()</code> используется  для определения
                    того, были ли заголовки отправлены ранее. Опционально он
                    принимает флаг, указывающий, бросать или нет исключение,
                    если заголовки были уже отправлены. Генерация таких
                    исключений может быть отменена посредством установки
                    свойства <code class="code">headersSentThrowsException</code> в
                    <b><tt>FALSE</tt></b>.
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                    <code class="code">setHeader($name, $value, $replace = false)</code>
                    используется для установки отдельного заголовка. По
                    умолчанию он не замещает в объекте существующие под тем же
                    именем заголовки. Но установкой
                    <var class="varname">$replace</var> в <b><tt>TRUE</tt></b> можно произвести
                    принудительную замену заголовка.
                </p>

                <p class="para">
                    До установки заголовка он вызывает другой метод
                    <code class="code">canSendHeaders()</code> для проверки того, можно ли
                    выполнить данную операцию, и прверяет, было ли брошено
                    исключение.
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                    <code class="code">setRedirect($url, $code = 302)</code> устанавливает
                    HTTP-заголовок &quot;Location&quot; для перенаправления.
                    Если был передан код статуса HTTP, то он будет
                    использоваться при перенаправлении.
                </p>

                <p class="para">
                    Внутри себя он вызывает <code class="code">setHeader()</code> со
                    флагом <var class="varname">$replace</var> для обеспечения гарантии того,
                    что отправляется только один такой заголовок.
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                    <code class="code">getHeaders()</code> возвращает массив всех заголовков.
                    Каждый элемент массива является массивом со ключами &#039;name&#039; и
                    &#039;value&#039;.
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                    <code class="code">clearHeaders()</code> удаляет все зарегистрированные
                    ранее заголовки.
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                    <code class="code">setRawHeader()</code> может использоваться для
                    установки заголовков, которые не являются парами
                    ключ/значение, например, заголовок статуса HTTP.
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                    <code class="code">getRawHeaders()</code> возвращает все
                    зарегистрированные через <code class="code">setRawHeader()</code>
                    заголовки.
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                    <code class="code">clearRawHeaders()</code> удаляет все
                    зарегистрированные через <code class="code">setRawHeader()</code>
                    заголовки.
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                    <code class="code">clearAllHeaders()</code> удаляет как обычные
                    заголовки из пар ключ/значение, так и
                    &quot;необработанные&quot; (raw).
                </p>
            </li>
        </ul>

        <p class="para">
            Кроме перечисленных выше методов, есть аксессоры для установки и
            получения кода ответа для текущего запроса,
            <code class="code">setHttpResponseCode()</code> и
            <code class="code">getHttpResponseCode()</code>.
        </p>
    </div>

    <div class="section" id="zend.controller.response.namedsegments" name="zend.controller.response.namedsegments"><div class="info"><h1 class="title">Именованные сегменты</h1></div>
        

        <p class="para">
            Объект ответа поддерживает именованные сегменты. Это позволяет
            делить содержимое ответа на различные сегменты и упорядочивать эти
            сегменты так, что вывод будет возвращаться в определенном порядке.
            Внутри содержимое тела ответа сохраняется в массиве, и могут
            использоваться различные методы-аксессоры для указания размещения и
            имен в этом массиве.
        </p>

        <p class="para">
            Например, вы можете использовать перехватчик
            <code class="code">preDispatch()</code> для добавления верха страницы в
            объект ответа, затем метод действия должен добавить тело
            страницы, а перехватчик <code class="code">postDispatch()</code> добавляет низ
            страницы:
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// Предполагается, что класс плагина зарегистрирован во фронт-контроллере</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #000000; font-weight: bold;">class</span> MyPlugin <span style="color: #000000; font-weight: bold;">extends</span> Zend_Controller_Plugin_Abstract</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> preDispatch<span style="color: #66cc66;">&#40;</span>Zend_Controller_Request_Abstract <span style="color: #0000ff;">$request</span><span style="color: #66cc66;">&#41;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$response</span> = <span style="color: #0000ff;">$this</span>-&gt;<span style="color: #006600;">getResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$view</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_View<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$view</span>-&gt;<span style="color: #006600;">setBasePath</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'../views/scripts'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">prepend</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'header'</span>, <span style="color: #0000ff;">$view</span>-&gt;<span style="color: #006600;">render</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'header.phtml'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> postDispatch<span style="color: #66cc66;">&#40;</span>Zend_Controller_Request_Abstract <span style="color: #0000ff;">$request</span><span style="color: #66cc66;">&#41;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$response</span> = <span style="color: #0000ff;">$this</span>-&gt;<span style="color: #006600;">getResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$view</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_View<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$view</span>-&gt;<span style="color: #006600;">setBasePath</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'../views/scripts'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">append</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'footer'</span>, <span style="color: #0000ff;">$view</span>-&gt;<span style="color: #006600;">render</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'footer.phtml'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// Пример контроллера действий</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #000000; font-weight: bold;">class</span> MyController <span style="color: #000000; font-weight: bold;">extends</span> Zend_Controller_Action</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> fooAction<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$this</span>-&gt;<span style="color: #006600;">render</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#125;</span></div></li></ol></div></div></div>


        <p class="para">
            В примере выше вызов <code class="code">/my/foo</code> приведет к тому, что
            конечное содержимое тела объекта ответа будет иметь следующую
            структуру:
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">&#40;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #ff0000;">'header'</span>&nbsp; =&gt; ..., <span style="color: #808080; font-style: italic;">// содержимое верха страницы</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #ff0000;">'default'</span> =&gt; ..., <span style="color: #808080; font-style: italic;">// содержимое тела страницы из MyController::fooAction()</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #ff0000;">'footer'</span>&nbsp; =&gt; ...&nbsp; <span style="color: #808080; font-style: italic;">// содержимое низа страницы</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            Рендеринг производится в том порядке, в котором элементы
            представлены в массиве.
        </p>

        <p class="para">
            Для управления именованными сегментами могут использоваться
            различные методы:
        </p>

        <ul class="itemizedlist">
            <li class="listitem">
                <p class="para">
                    <code class="code">setBody()</code> и <code class="code">appendBody()</code> позволяют
                    передавать второе значение, <var class="varname">$name</var>, обозначающее
                    именованный сегмент. В любом случае, если вы передаете его,
                    он перепишет этот именованный сегмент или создаст его, если
                    он не существует (по умолчанию добавляя в конец массива).
                    Если методу <code class="code">setBody()</code> не был передан
                    именованный сегмент, то будет сброшен весь массив
                    содержимого тела. Если методу <code class="code">appendBody()</code> не
                    было передано имя сегмента, то содержимое будет добавлено в
                    конец сегмента с именем &#039;default&#039;.
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                    <code class="code">prepend($name, $content)</code> будет создавать
                    сегмент с именем <var class="varname">$name</var> и помещать его в начало
                    массива. Если сегмент уже существует, то он будет удален до
                    операции добавления (т.е. перезаписан).
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                    <code class="code">append($name, $content)</code> будет создавать сегмент
                    с именем <var class="varname">$name</var> и помещать его в конец массива.
                    Если сегмент уже существует, то он будет удален до операции
                    добавления.
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                    <code class="code">insert($name, $content, $parent = null, $before = false)</code>
                    будет создавать сегмент с именем <var class="varname">$name</var>. Если
                    был передано имя сегмента <var class="varname">$parent</var> (родитель),
                    то новый сегмент будет помещен до или после этого сегмента
                    (основываясь на значениии <var class="varname">$before</var>) в массиве.
                    Если сегмент уже существует, то он будет удален до операции
                    добавления.
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                    <code class="code">clearBody($name = null)</code> удалит один
                    сегмент, если был передано его имя <var class="varname">$name</var>,
                    иначе будет удален весь массив.
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                    <code class="code">getBody($spec = false)</code> может использоваться для
                    получения массива сегментов, если <var class="varname">$spec</var> - имя
                    именованного сегмента. Если равен false, то будет возвращена
                    строка, сформированная посредством объединения всех
                    сегментов в порядке следования. Если <var class="varname">$spec</var>
                    равен true, то он вернет массив содержимого тела.
                </p>
            </li>
        </ul>
    </div>

    <div class="section" id="zend.controller.response.exceptions" name="zend.controller.response.exceptions"><div class="info"><h1 class="title">Проверка на исключения в объекте ответа</h1></div>
        

        <p class="para">
            Как было отмечено ранее, по умолчанию исключения, пойманные во время
            диспетчеризации, регистрируются в объекте ответа. Исключения
            регистрируются в стеке, что позволяет вам хранить все брошенные
            исключения - исключения приложения, диспетчера, плагинов и т.д.
            Если нужно производить проверку на определенные исключения или
            журналировать их, то используйте следующее API объекта ответа для
            исключений:
        </p>

        <ul class="itemizedlist">
            <li class="listitem">
                <p class="para">
                    <code class="code">setException(Exception $e)</code> позволяет
                    произвести регистрацию исключения.
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                    <code class="code">isException()</code> позволяет определить, было ли
                    зарегистрировано какое-либо исключение.
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                    <code class="code">getException()</code> возвращает весь стек
                    исключений.
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                    <code class="code">hasExceptionOfType($type)</code> позволяет определить
                    наличие в стеке исключения определенного класса.
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                    <code class="code">hasExceptionOfMessage($message)</code> позволяет
                    определить наличие в стеке исключения с заданным
                    сообщением.
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                    <code class="code">hasExceptionOfCode($code)</code> позволяет определить
                    наличие в стеке исключения с определенным кодом.
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                    <code class="code">getExceptionByType($type)</code> позволяет извлечь все
                    исключения определенного класса из стека.
                    Возвращает false, если не был найдено ни одно
                    исключение, иначе - массив исключений.
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                    <code class="code">getExceptionByMessage($message)</code> позволяет
                    извлекать все исключения с заданным сообщением из стека.
                    Возвращает false, если не был найдено ни одно
                    исключение, иначе - массив исключений.
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                    <code class="code">getExceptionByCode($code)</code> позволяет извлекать
                    все исключения с определенным кодом из стека.
                    Возвращает false, если не был найдено ни одно
                    исключение, иначе - массив исключений.
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                    <code class="code">renderExceptions($flag)</code> позволяет установить
                    флаг, указывающий, должны или нет отправляться исключения
                    вместе с ответом.
                </p>
            </li>
        </ul>
    </div>

    <div class="section" id="zend.controller.response.subclassing" name="zend.controller.response.subclassing"><div class="info"><h1 class="title">Создание подклассов объекта ответа</h1></div>
        

        <p class="para">
            Назначением объекта ответа является сбор заголовков и содержимого из
            различных действий и плагинов, и возврат их клиенту. Кроме этого, он
            собирает все возникающие ошибки (исключения) для того, чтобы
            обрабатывать их, возвращать или прятать от конечного пользователя.
        </p>

        <p class="para">
            Базовым классом ответа является
            <span class="classname">Zend_Controller_Response_Abstract</span>, все
            создаваемые вами подклассы должны наследовать от него или одного из
            его потомков. Доступные методы были перечислены в предыдущих
            разделах.
        </p>

        <p class="para">
            Цели, преследуемые при создании подклассов объекта ответа, включают
            в себя изменение способа вывода, основанное на
            окружении запроса (например, не отправлять заголовки для запросов
            CLI или PHP-GTK), добавление функционала для возвращения конечного
            вида, основанного на содержимом, сохраненном в именованном сегменте,
            и т.д.
        </p>
    </div>
</div>
        <hr />

            <table width="100%">
                <tr>
                    <td width="25%" style="text-align: left;">
                    <a href="zend.controller.actionhelpers.html">Помощники действий</a>
                    </td>

                    <td width="50%" style="text-align: center;">
                        <div class="up"><span class="up"><a href="zend.controller.html">Zend_Controller</a></span><br />
                        <span class="home"><a href="manual.html">Programmer's Reference Guide</a></span></div>
                    </td>

                    <td width="25%" style="text-align: right;">
                        <div class="next" style="text-align: right; float: right;"><a href="zend.controller.plugins.html">Плагины</a></div>
                    </td>
                </tr>
            </table>
</td>
        <td style="font-size: smaller;" width="15%"> <style type="text/css">
#leftbar {
	float: left;
	width: 186px;
	padding: 5px;
	font-size: smaller;
}
ul.toc {
	margin: 0px 5px 5px 5px;
	padding: 0px;
}
ul.toc li {
	font-size: 85%;
	margin: 1px 0 1px 1px;
	padding: 1px 0 1px 11px;
	list-style-type: none;
	background-repeat: no-repeat;
	background-position: center left;
}
ul.toc li.header {
	font-size: 115%;
	padding: 5px 0px 5px 11px;
	border-bottom: 1px solid #cccccc;
	margin-bottom: 5px;
}
ul.toc li.active {
	font-weight: bold;
}
ul.toc li a {
	text-decoration: none;
}
ul.toc li a:hover {
	text-decoration: underline;
}
</style>
 <ul class="toc">
  <li class="header home"><a href="manual.html">Programmer's Reference Guide</a></li>
  <li class="header up"><a href="manual.html">Programmer's Reference Guide</a></li>
  <li class="header up"><a href="reference.html">Zend Framework Reference</a></li>
  <li class="header up"><a href="zend.controller.html">Zend_Controller</a></li>
  <li><a href="zend.controller.quickstart.html">Zend_Controller - Быстрый старт</a></li>
  <li><a href="zend.controller.basics.html">Основы Zend_Controller</a></li>
  <li><a href="zend.controller.front.html">Фронт-контроллер</a></li>
  <li><a href="zend.controller.request.html">Объект запроса</a></li>
  <li><a href="zend.controller.router.html">Стандартный маршрутизатор</a></li>
  <li><a href="zend.controller.dispatcher.html">Диспетчер</a></li>
  <li><a href="zend.controller.action.html">Контроллеры действий</a></li>
  <li><a href="zend.controller.actionhelpers.html">Помощники действий</a></li>
  <li class="active"><a href="zend.controller.response.html">Объект ответа</a></li>
  <li><a href="zend.controller.plugins.html">Плагины</a></li>
  <li><a href="zend.controller.modular.html">Использование модульной структуры директорий</a></li>
  <li><a href="zend.controller.exceptions.html">Исключения</a></li>
 </ul>
 </td>
    </tr>
</table>
</body>
</html>