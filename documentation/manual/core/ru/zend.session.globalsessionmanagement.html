<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>Общее управление сессиямиGlobal Session Management - Zend Framework Manual</title>

</head>
<body>
<table width="100%">
    <tr valign="top">
        <td width="85%">
            <table width="100%">
                <tr>
                    <td width="25%" style="text-align: left;">
                    <a href="zend.session.advanced_usage.html">Расширенное использование</a>
                    </td>

                    <td width="50%" style="text-align: center;">
                        <div class="up"><span class="up"><a href="zend.session.html">Zend_Session</a></span><br />
                        <span class="home"><a href="manual.html">Programmer's Reference Guide</a></span></div>
                    </td>

                    <td width="25%" style="text-align: right;">
                        <div class="next" style="text-align: right; float: right;"><a href="zend.session.savehandler.dbtable.html">Zend_Session_SaveHandler_DbTable</a></div>
                    </td>
                </tr>
            </table>
<hr />
<div id="zend.session.globalsessionmanagement" class="section"><div class="info"><h1 class="title">Общее управление сессиями</h1></div>

    

    <p class="para">
        Поведение сессий, принятое по умолчанию, можно изменить, используя
        статические методы класса Zend_Session. Все управление производится
        посредством Zend_Session, включая конфигурирование
        <a href="http://www.php.net/session#session.configuration" class="link external">&raquo; через
        опции, предоставляемые расширением ext/session</a>, с использованием
        метода <code class="code">Zend_Session::setOptions()</code>.

    </p>

    <div class="section" id="zend.session.setoptions" name="zend.session.setoptions"><div class="info"><h1 class="title">Zend_Session::setOptions()</h1></div>

        

        <p class="para">
            Когда запрашивается первое пространство имен, то автоматически
            запустится Zend_Session, если только оно не было запущено ранее
            через метод
            <a href="" class="link"><code class="code">Zend_Session::start()</code></a>.
            Встроенный в PHP механизм сессий будет использовать принятые по
            умолчанию настройки из Zend_Session, пока они не будут изменены
            через метод <code class="code">Zend_Session::setOptions()</code>.

        </p>

        <p class="para">
            Для того, чтобы передать опции, просто передайте базовое имя (без
            приставки <code class="code">session.</code>) как часть массива методу
            <code class="code">Zend_Session::setOptions()</code>. Если опции не были
            установлены, то Zend_Session будет сначала использовать
            рекомендуемые опции, затем установки по умолчанию из php.ini.
            Предложения по оптимизации работы с опциями отправляйте в список
            рассылки
            <a href="mailto:fw-auth@lists.zend.com" class="link external">&raquo; fw-auth@lists.zend.com</a>.

        </p>

        <p class="para">
            &quot;Автоматическое&quot; конфигурипрование этой компоненты с использованием
            Zend_Config_Ini:

            <div class="example"><div class="info"><p><b>Example #1 Использование Zend_Config для конфирурирования Zend_Session</b></p></div>
                
<div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #000000; font-weight: bold;">&lt;?php</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$config</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_Config_Ini<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'myapp.ini'</span>, <span style="color: #ff0000;">'sandbox'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #b1b100;">require_once</span> <span style="color: #ff0000;">'Zend/Session.php'</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">Zend_Session::<span style="color: #006600;">setOptions</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$config</span>-&gt;<span style="color: #006600;">toArray</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #000000; font-weight: bold;">?&gt;</span></div></li></ol></div></div></div>

            </div>
            Используемый файл &quot;myapp.ini&quot;:

            <div class="example"><div class="info"><p><b>Example #2 myapp.ini</b></p></div>
                
<div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">;&nbsp; Настройки по умолчанию для производственного сервера</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#91;</span>live<span style="color: #66cc66;">&#93;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; bug_compat_42</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; bug_compat_warn</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #ff0000">; cache_expire</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; cache_limiter</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; cookie_domain</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; cookie_lifetime</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; cookie_path</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; cookie_secure</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; entropy_file</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; entropy_length</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; gc_divisor</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; gc_maxlifetime</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; gc_probability</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; hash_bits_per_character</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; hash_function</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; имя должно быть уникальным для всех приложений, использующих</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; одно и то же доменное имя</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">name = UNIQUE_NAME</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; referer_check</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; save_handler</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #ff0000">; save_path</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; serialize_handler</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; use_cookies</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; use_only_cookies</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; use_trans_sid</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; remember_me_seconds = &lt;integer seconds&gt;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; strict = on|off</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; Наш тестовый сервер использует те же настройки, что и наш</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; производственный сервер за исклочением тех, что переопределяются ниже:</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#91;</span>sandbox : live<span style="color: #66cc66;">&#93;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; Не забудьте создать эту директорию и сделать ее доступной для чтения</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; и записи через PHP</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">save_path = /home/myaccount/zend_sessions/myapp</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">use_only_cookies = on</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; Когда индентификатор сессии сохраняется в куках, запрашивать TTL</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">; через <span style="color: #cc66cc;">10</span> дней</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">remember_me_seconds = <span style="color: #cc66cc;">864000</span></div></li></ol></div></div></div>

            </div>
        </p>

    </div>

    <div class="section" id="zend.session.options" name="zend.session.options"><div class="info"><h1 class="title">Опции</h1></div>

        

        <p class="para">
            Большинство опций, указанных ниже, не нуждается в дополнительных
            комментариях сверх того, что написано в стандартной документации по
            PHP.

            <ul class="itemizedlist">
                <li class="listitem">
                    <p class="para">
                        boolean <code class="code">strict</code> - отключает автоматический
                        запуск <code class="code">Zend_Session</code> при использовании
                        <code class="code">new Zend_Session_Namespace()</code>.

                    </p>
                </li>
                <li class="listitem">
                    <p class="para">
                        integer <code class="code">remember_me_seconds</code> - время
                        хранения идентификатора сессии в куках после того, как
                        агент пользователя завершит свою работу (т.е. когда окно
                        броузера будет закрыто).

                    </p>
                </li>
                <li class="listitem">
                    <p class="para">
                        string <code class="code">save_path</code> - корректное значение
                        зависит от системы и должно указываться разработчиком с
                        использованием <em class="emphasis">абсолютного
                        пути</em> к директории, доступной для чтения и
                        записи процессом PHP. Если директория на заданном пути
                        не существует или недоступна, то
                        <code class="code">Zend_Session</code> бросает исключение во время
                        старта (т.е. когда вызывается метод
                        <code class="code">start()</code>)

                    </p>
                    <blockquote><p><b class="note">Note</b>: <span class="info"><b>Угроза безопасности</b><br /></span>
                        
                        
                            Если путь доступен для чтения другими приложениями,
                            то возможен угон сессий (session hijacking). Если
                            путь доступен для записи другими приложениями, то
                            возможно заражение сессий
                            (<a href="http://en.wikipedia.org/wiki/Session_poisoning" class="link external">&raquo; session poisoning</a>).
                            Если этот путь используется совместно с другими
                            пользователями или с другими PHP-приложениями, то
                            это создает различные угрозы безопасности,
                            включая кражу содержимого сессий, угон сессий и
                            коллизии при &quot;сборке мусора&quot; (например, работа
                            приложения другого пользователя может вызвать
                            удаление файлов сессий вашего приложения).

                        <br />
                        
                            Например, атакующий может зайти на сайт жертвы для
                            получения сессионных куков. Затем он изменяет путь
                            куков на собственный домен для того же сервера и
                            заходит на собственный сайт для выполнения
                            <code class="code">var_dump($_SESSION)</code>. Вооруженный
                            информацией о том, как жертва использует данные в
                            своих сессиях, атакующий может модифицировать данные
                            сессии (заражение сессии), возвращает значение пути
                            куков на исходный (ведущий на сайт жертвы) и делает
                            запросы с сайта жертвы, используя зараженную сессию.
                            Даже если оба приложения на том же сервере не имеют
                            прав чтения/записи в директории save_path другого
                            приложения, то в том случае, если можно заходить в
                            директорию save_path и атакующий имеет контроль над
                            одним из сайтов, он может изменить save_path своего
                            сайта на save_path жертвы и таким образом выполнить
                            заражение сессии под некоторыми общими
                            конфигурациями PHP. Поэтому значение save_path не
                            должно быть достоянием общественности и должно быть
                            изменено на секретное значение, уникальное для
                            каждого приложения.

                        <br />
                    </p></blockquote>
                </li>
                <li class="listitem">
                    <p class="para">
                        string <code class="code">name</code> - корректное значение зависит
                        от системы и должно устанавливаться разработчиком, с
                        использованием короткого значения,
                        <em class="emphasis">уникального</em> для
                        приложения ZF.

                    </p>
                    <blockquote><p><b class="note">Note</b>: <span class="info"><b>Угроза безопасности</b><br /></span>
                        
                        
                            Если настройки в <code class="code">php.ini</code> для
                            <code class="code">session.name</code> одинаковые для
                            приложений (например, &quot;PHPSESSID&quot; для настроек по
                            умолчанию) и через одно доменное имя доступны два и
                            более приложений (например,
                            <code class="code">http://www.somewebhost.com/~youraccount/index.php</code>),
                            то они будут использовать одни и те же данные
                            сессий для посетителей, посещающих оба сайта. Это
                            может привести к разрушению данных сессий.

                        <br />
                    </p></blockquote>
                </li>
                <li class="listitem">
                    <p class="para">
                        boolean <code class="code">use_only_cookies</code> - во избежание
                        появления дополнительных угроз безопасности не изменяйте
                        значение, принятое по умолчанию для этой опции, на
                        другое.

                        <blockquote><p><b class="note">Note</b>: <span class="info"><b>Угроза безопасности</b><br /></span>
                            
                            
                                Если эта опция не включена, то аттакующий может
                                легко &quot;фиксировать&quot; идентификаторы сессии,
                                используя ссылки на атакуемый сайт вида
                                <code class="code">http://www.victim-website.com/index.php?PHPSESSID=fixed_session_id</code>.
                                Фиксация будет работать, если жертва не всегда
                                имеет куки с идентификатором сессии для
                                victim-website.com. Как только жертва будет
                                использовать известный атакующему идентификатор
                                сессии, атакующий может попытаться угнать
                                сессию, имитируя реального пользователя и
                                эмулируя агента жертвы.

                            <br />
                        </p></blockquote>
                    </p>
                </li>
            </ul>
        </p>

    </div>

    <div class="section" id="zend.session.regenerateid" name="zend.session.regenerateid"><div class="info"><h1 class="title">regenerateId()</h1></div>

        

        <div class="section" id="zend.session.regenerateid.intro" name="zend.session.regenerateid.intro"><div class="info"><h1 class="title">Введение: идентификаторы сессий</h1></div>

            

            <p class="para">
                Введение: Наилучшей практикой в использовании сессий с ZF будет
                использование куков вместо сохранения идентификатора сессии в
                URL для отслеживания отдельных пользователей. По
                умолчанию эта компонента использует только куки для хранения
                идентификатора сессии. Значением, сохраняемым в куках, является
                уникальный идентификатор сессии. Расширение ext/session
                использует этот идентификатор для поддержки однозначно
                определяемой связи &quot;один-к-одному&quot; между посетителем сайта и
                хранилищем постоянных данных сессии, уникальным для каждого
                посетителя. Zend_Session* является оберткой к этому механизму
                хранения (<var class="varname">$_SESSION</var>) с объектно-ориентированным
                интерфейсом. К сожалению, если атакующий получил доступ к
                идентификатору сессии в куках, то он может угнать сессию
                посетителя. Эта проблема не является присущей только PHP или
                Zend Framework. Метод <code class="code">regenerateId()</code> позволяет
                приложению изменять идентификатор сессии (сохраненный в куках
                посетителя) на новое случайное значение. Замечание: Несморя на
                то, что эти термины не равнозначны, для удобочитаемости мы будем
                попеременно использовать &quot;агент пользователя&quot; и &quot;веб-броузер&quot;.

            </p>

            <p class="para">
                Почему?: Если атакующий получил валидный идентификатор сессии,
                то он может имитировать реального пользователя (жертву) и затем
                получить доступ к конфиденциальной информации или манипулировать
                данными жертвы через ваше приложение. Изменение идентификатора
                сессии помогает защитить пользователя от угона сессии. Если
                идентификатор сессии был изменен и атакующий не знает его новое
                значение, то он не может использовать новый идентификатор сессии
                в своей попытке угона сессии посетителя. Даже если атакующий
                получил доступ к старому идентификатору сессии, то
                <code class="code">regenerateId()</code> перемещает данные сессии со старого
                идентификатора на новый, и поэтому данные этой сессии не будут
                доступны через старый идентификатор.

            </p>

            <p class="para">
                Когда использовать regenerateId(): Добавление
                <code class="code">Zend_Session::regenerateId()</code> в файл загрузки
                Zend Framework является одним из самых безопасных и надежных
                способов регенерации идентификаторов сессии в куках агента
                пользователя. Само по себе отсутствие условной логики,
                определяющей, когда регенерировать идентификатор сессии, не
                является признаком плохо разработанного кода. Но, несмотря на
                то, что регенерация при каждом запросе пересекает некоторые
                возможные пути атак, не все хотят мириться с небольшой потерей в
                производительности и пропускной способности, связанными с
                регенерацией. Поэтому приложения обычно пытаются определить
                ситуации, связанные с наибольшим риском, и только тогда
                регенерируют идентификаторы сессий. В случаях, когда привилегии
                сессии посетителя сайта &quot;обостряются&quot; (например, посетитель
                заново проходит аутентификацию до изменения его личного
                &quot;профиля&quot;) или когда производятся &quot;чувствительные&quot; для
                безопасности изменения параметров сессии, используется
                <code class="code">regenerateId()</code> для регенерации идентификатора
                сессии. Если вы вызываете функцию <code class="code">rememberMe()</code>, то
                не используйте <code class="code">regenerateId()</code>, т.к. первая функция
                вызывает вторую. Если пользователь успешно залогинился на вашем
                сайте, используйте <code class="code">rememberMe()</code> вместо
                <code class="code">regenerateId()</code>.

            </p>

        </div>

        <div class="section" id="zend.session.regenerateid.details" name="zend.session.regenerateid.details"><div class="info"><h1 class="title">Угон и фиксация сессии</h1></div>

            

            <p class="para">
                Отсутствие XSS-уязвимостей на сайте помогает предотвратить угон
                сессий c него. Согласно
                статистике <a href="http://secunia.com/" class="link external">&raquo; Secunia</a>,
                <a href="http://en.wikipedia.org/wiki/Cross_site_scripting" class="link external">&raquo; 
                XSS (межсайтовый скриптинг)</a> - довольно распространенное
                явление. Лучше минимизировать возможный ущерб от XSS, следуя
                наилучшей практике программирования, чем предполагать, что этого
                никогда не случится с вами. Атакующему, использующему
                XSS, не нужно иметь прямой доступ к сетевому трафику жертвы.
                Если жертва уже имеет сессионные куки, то XSS с внедрением кода
                Javascript позволит атакующему прочитать куки и украсть сессию.
                Если жертва не имеет сессионные куки, то, используя XSS с
                внедрением кода Javascript, атакующий может создать куку с
                заранее известным идентификатором сессии в броузере жертвы,
                затем установить идентичную куку в своей системе, чтобы угнать
                сессию жертвы. Если жертва посетит сайт атакующего, то
                атакующий может также сэмулировать и другие доступные для
                идентификации характеристики агента пользователя жертвы. Если
                ваш сайт имеет XSS-уязвимости, то атакующий может внедрить
                AJAX-код, который скрытно &quot;заходит&quot; на сайт атакующего, и
                атакующий может узнать характеристики броузера жертвы и о
                скомпрометированной сессии на сайте жертвы. Но несмотря на все
                это, атакующий не может изменить данные сессии на стороне
                сервера при условии, что разработчик корректно установил
                значение опции <code class="code">save_path</code>.

            </p>

            <p class="para">
                Сам по себе вызов <code class="code">Zend_Session::regenerateId()</code>
                в то время, как сессия еще только начинает использоваться, не
                предотвращает атаку через фиксацию сессии, за исключением
                того случая, когда вы можете отличить сессию, созданную
                атакующим, имитирующим личность жертвы. На первый взгляд это
                противоречит предыдущему утверждению, но до тех пор, пока мы не
                будем считать атакующим того, кто первый иницировал создание
                настоящей сессии на вашем сайте. Сессия сначала используется
                атакующим, который знает результат инициализации
                (<code class="code">regenerateId()</code>). Атакующий затем использует новый
                идентификатор сессии вместе с найденной XSS-уязвимостью или
                добавляет идентификатор сессии в ссылку на сайт атакующего
                (работает в том случае, если
                <code class="code">use_only_cookies = off</code>).

            </p>

            <p class="para">
                Если вы можете различать атакующего и жертву, использующих один
                и тот же идентификатор сессии, то это может решить проблему
                увода сессии. Тем не менее, такое распознавание обычно
                принуждает к поиску компромисса с юзабилити, т.к. методы
                различения нередко являются неточными. Для примера, если запрос
                получен с IP в стране, отличающейся от IP запроса, при котором
                была создана сессия, то это может означать, что новый запрос
                производится уже атакующим. При выполнении следующих условий
                приложение сайта не сможет различить жертву и атакующего:

                <ul class="itemizedlist">
                    <li class="listitem">
                        <p class="para">
                            - атакующий первый иницировал сессию на вашем сайте для получения валидного идентификатора сессии

                        </p>
                    </li>
                    <li class="listitem">
                        <p class="para">
                            - атакующий использует XSS-уязвимость на вашем сайте для создания куки в броузере жертвы с валидным идентификатором сессии (т.е. фиксация сессии)

                        </p>
                    </li>
                    <li class="listitem">
                        <p class="para">
                            - атакующий и его жертва заходят через одну и ту же группу прокси-серверов (например, оба находятся за одним и тем же файрволом в большой компании - такой, как AOL)

                        </p>
                    </li>
                </ul>

                Пример кода ниже намного затрудняет получение атакующим текущего идентификатора сессии жертвы, за исключением тех случаев, когда атакующий уже выполнил первые два шага из приведенных выше.

            </p>

            <div class="example"><div class="info"><p><b>Example #3 Анонимная сессия и фиксация сессии</b></p></div>
                
<div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #000000; font-weight: bold;">&lt;?php</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #b1b100;">require_once</span> <span style="color: #ff0000;">'Zend/Session.php'</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$defaultNamespace</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_Session_Namespace<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #b1b100;">if</span> <span style="color: #66cc66;">&#40;</span>!<a href="http://www.php.net/isset"><span style="color: #000066;">isset</span></a><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$defaultNamespace</span>-&gt;<span style="color: #006600;">initialized</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; Zend_Session::<span style="color: #006600;">regenerateId</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #0000ff;">$defaultNamespace</span>-&gt;<span style="color: #006600;">initialized</span> = <span style="color: #000000; font-weight: bold;">true</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #000000; font-weight: bold;">?&gt;</span></div></li></ol></div></div></div>

            </div>

        </div>

    </div>

    <div class="section" id="zend.session.rememberme" name="zend.session.rememberme"><div class="info"><h1 class="title">rememberMe(integer $seconds)</h1></div>

        

        <p class="para">
            Обычно сессия заканчивается, когда агент пользователя завершает
            сеанс работы - например, пользователь закрыл окно броузера. Тем не
            менее, после того как пользователь зашел в систему, может
            понадобиться хранить его сессию 24 часа и больше. Программное
            обеспечение форумов обычно предоставляет пользователю возможность
            выбирать, сколько времени должна храниться сессиия.  Используйте
            <code class="code">Zend_Session::rememberMe()</code> для отправки
            обновленной сессионной куки агенту пользователя со временем жизни,
            по умолчанию равному <code class="code">remember_me_seconds</code>, который равен
            2 неделям до тех пор, пока вы не измените это значение через метод
            <code class="code">Zend_Session::setOptions()</code>. Для того, чтобы
            помешать угону или фиксации сессии, используйте эту функцию, когда
            пользователь успешно прошел аутентификацию и ваше приложение
            выполнило &quot;регистрацию&quot;

        </p>

    </div>

    <div class="section" id="zend.session.forgetme" name="zend.session.forgetme"><div class="info"><h1 class="title">forgetMe()</h1></div>

        

        <p class="para">
            Эта функция является дополнением к <code class="code">rememberMe()</code>.
            Она возвращает сессионную куку к тому состоянию, при котором ее
            время жизни завершается в тот момент, когда агент пользователя
            завершает сеанс работы (например, пользователь закрыл окно своего
            броузера).

        </p>

    </div>

    <div class="section" id="zend.session.sessionexists" name="zend.session.sessionexists"><div class="info"><h1 class="title">sessionExists()</h1></div>

        

        <p class="para">
            Используйте этот метод для определения того, есть ли уже сессия для
            текущего агента пользователя/запроса. Он может использоваться до
            старта сессии и независимо от всех других методов Zend_Session и
            Zend_Session_Namespace.

        </p>

    </div>

    <div class="section" id="zend.session.destroy" name="zend.session.destroy"><div class="info"><h1 class="title">destroy(bool $remove_cookie = true, bool $readonly = true)</h1></div>

        

        <p class="para">
            <code class="code">Zend_Session::destroy()</code> уничтожает все постоянные
            данные, связанные с текущей сессией. Это не влияет на переменные в
            PHP, поэтому ваши сессии с пространствами имен (экземпляры
            <code class="code">Zend_Session_Namespace</code>) остаются доступными для чтения.
            Для выхода из системы установите необязательный параметр в
            <b><tt>TRUE</tt></b> (по умолчанию он равен <b><tt>TRUE</tt></b>), при
            этом будет удалена кука с идентификатором сессии в агенте
            пользователя. Установленный в <b><tt>TRUE</tt></b> необязательный
            параметр <var class="varname">$readonly</var> блокирует возможность записи в
            данные сессии (т.е. в $_SESSION) для экземпляров
            Zend_Session_Namespace и методов Zend_Session.

        </p>

        <blockquote><p><b class="note">Note</b>: <span class="info"><b>Исключения</b><br /></span>
            
            
                По умолчанию <var class="varname">$readonly</var> установлен в
                <b><tt>TRUE</tt></b> и дальнейшие действия, подразумевающие запись
                в хранилище данных сессии, вызовут генерацию исключения.

            <br />
        </p></blockquote>

    </div>

    <div class="section" id="zend.session.stop" name="zend.session.stop"><div class="info"><h1 class="title">stop()</h1></div>

        

        <p class="para">
            Этот метод не делает ничего, кроме переключения флага в
            Zend_Session для предотвращения дальнейшей записи в хранилище
            данных сессии (т.е.<var class="varname">$_SESSION</var>). Одним из вариантов его
            использования является временное отключение возможности записи в
            хранилище данных сессии через экземпляры
            <code class="code">Zend_Session_Namespace</code> или методы
            <code class="code">Zend_Session</code> во время выполнения кода,
            связанного с отображением вида.
            Попытка выполнить действия, подразумевающие запись через эти
            экземпляры или методы вызовет генерацию исключения.

        </p>

    </div>

    <div class="section" id="zend.session.writeClose" name="zend.session.writeClose"><div class="info"><h1 class="title">writeClose($readonly = true)</h1></div>

        

        <p class="para">
            Закрывает сессию, завершает запись и отсоединяет $_SESSION от
            средства хранения на сервере. Это завершит внутреннее преобразование
            данных для данного запроса. Необязательный параметр булевого типа
            $readonly позволяет отключить возможность записи (т.е. генерация
            исключения при попытке записи через любые методы
            Zend_Session_Namespace или Zend_Session).

        </p>

        <blockquote><p><b class="note">Note</b>: <span class="info"><b>Исключения</b><br /></span>
            
            
                По умолчанию <var class="varname">$readonly</var> включен и дальнейшие
                действия, подразумевающие запись в хранилище данных сессии,
                вызовут генерацию исключения.

            <br />
        </p></blockquote>

    </div>

    <div class="section" id="zend.session.expiresessioncookie" name="zend.session.expiresessioncookie"><div class="info"><h1 class="title">expireSessionCookie()</h1></div>

        

        <p class="para">
            Этот метод отправляет куку с уже истекшим временем действия, что
            вызывает удаление сессионной куки в агенте пользователя. Иногда этот
            метод используется для выхода из системы со стороны клиента.

        </p>

    </div>

    <div class="section" id="zend.session.savehandler" name="zend.session.savehandler"><div class="info"><h1 class="title">setSaveHandler(Zend_Session_SaveHandler_Interface $interface)</h1></div>

        

        <p class="para">
            Большинство разработчиков находят достаточным использовать принятый
            по умолчанию механизм хранения сессионных данных.
            Этот метод предоставляет объектно-ориентированную обертку для <code class="code">
            <a href="http://php.net/session_set_save_handler" class="link external">&raquo; session_set_save_handler()</a>
            </code>.

        </p>

    </div>

    <div class="section" id="zend.session.namespaceisset" name="zend.session.namespaceisset"><div class="info"><h1 class="title">namespaceIsset($namespace)</h1></div>

        

        <p class="para">
            Используйте этот метод для определения того, существует ли
            пространство имен с данным именем или определенный индекс в данном
            пространстве имен.

        </p>

        <blockquote><p><b class="note">Note</b>: <span class="info"><b>Исключения</b><br /></span>
            
            
                Если Zend_Session не был помечен как доступный для чтения
                (например, до того, как Zend_Session был запущен), то будет
                сгенерировано исключение.

            <br />
        </p></blockquote>

    </div>

    <div class="section" id="zend.session.namespaceunset" name="zend.session.namespaceunset"><div class="info"><h1 class="title">namespaceUnset($namespace)</h1></div>

        

        <p class="para">
            Вместо создания экземпляра Zend_Session_Namespace для пространства
            имен и итерации по его содержимому для удаления каждой отдельной
            записи используйте метод <code class="code">namespaceUnset($namespace)</code> для
            быстрого удаления всего пространства имен и его содержимого. Как это
            справедливо для всех массивов в PHP, если переменная, содержащая
            массив, уничтожена, и этот массив содержал другие объекты, то эти
            объекты не уничтожаются, если они были сохранены по ссылке в других
            массивах/объектах. Это означает, что они остаются доступными через
            другие переменные. Поэтому <code class="code">namespaceUnset()</code> не
            производит &quot;глубокое&quot; удаление содержимого записей в пространстве
            имен. За более подробной информацией обращайтесь к разделу
            <a href="http://php.net/references" class="link external">&raquo; References Explained</a>
            в документации по PHP.

        </p>

        <blockquote><p><b class="note">Note</b>: <span class="info"><b>Исключения</b><br /></span>
            
            
                Если пространство имен недоступно для записи (например, после
                <code class="code">destroy()</code>), то будет сгенерировано исключение.

            <br />
        </p></blockquote>

    </div>

    <div class="section" id="zend.session.namespaceget" name="zend.session.namespaceget"><div class="info"><h1 class="title">namespaceGet($namespace)</h1></div>

        

        <p class="para">
            Не рекомендуется к использованию: Используйте
            <code class="code">getIterator()</code> в Zend_Session_Namespace. Этот метод
            возвращает массив содержимого пространства имен
            <var class="varname">$namespace</var>. Этот метод позднее может быть определен как
            закрытый. Если вы считаете, что есть разумные причины оставить этот
            метод открытым, то пишите в список рассылки
            <a href="mailto:fw-auth@lists.zend.com" class="link external">&raquo; fw-auth@lists.zend.com</a>.
            Участие в связанных темах также приветствуется :)

        </p>

        <blockquote><p><b class="note">Note</b>: <span class="info"><b>Исключения</b><br /></span>
            
            
                Если Zend_Session не был помечен как доступный для чтения
                (например, до того, как Zend_Session был запущен), то будет
                сгенерировано исключение.

            <br />
        </p></blockquote>

    </div>

    <div class="section" id="zend.session.getiterator" name="zend.session.getiterator"><div class="info"><h1 class="title">getIterator()</h1></div>

        

        <p class="para">
            Используйте метод <code class="code">getIterator()</code> для получения массива,
            содержащего имена всех пространств имен, и с которым можно
            производить итерации.

        </p>

        <div class="example"><div class="info"><p><b>Example #4 Уничтожение всех пространств имен</b></p></div>
            
<div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #000000; font-weight: bold;">&lt;?php</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #b1b100;">foreach</span><span style="color: #66cc66;">&#40;</span>Zend_Session::<span style="color: #006600;">getIterator</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span> <span style="color: #b1b100;">as</span> <span style="color: #0000ff;">$space</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; try <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$core</span>-&gt;<span style="color: #006600;">namespaceUnset</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$space</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#125;</span> catch <span style="color: #66cc66;">&#40;</span>Zend_Session_Exception <span style="color: #0000ff;">$e</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">return</span>; <span style="color: #808080; font-style: italic;">// possible if Zend_Session::stop() has been executed</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #000000; font-weight: bold;">?&gt;</span></div></li></ol></div></div></div>

        </div>

        <blockquote><p><b class="note">Note</b>: <span class="info"><b>Исключения</b><br /></span>
            
            
                Если Zend_Session не был помечен как доступный для чтения
                (например, до того, как Zend_Session был запущен), то будет
                сгенерировано исключение.

            <br />
        </p></blockquote>

    </div>

</div>
        <hr />

            <table width="100%">
                <tr>
                    <td width="25%" style="text-align: left;">
                    <a href="zend.session.advanced_usage.html">Расширенное использование</a>
                    </td>

                    <td width="50%" style="text-align: center;">
                        <div class="up"><span class="up"><a href="zend.session.html">Zend_Session</a></span><br />
                        <span class="home"><a href="manual.html">Programmer's Reference Guide</a></span></div>
                    </td>

                    <td width="25%" style="text-align: right;">
                        <div class="next" style="text-align: right; float: right;"><a href="zend.session.savehandler.dbtable.html">Zend_Session_SaveHandler_DbTable</a></div>
                    </td>
                </tr>
            </table>
</td>
        <td style="font-size: smaller;" width="15%"> <style type="text/css">
#leftbar {
	float: left;
	width: 186px;
	padding: 5px;
	font-size: smaller;
}
ul.toc {
	margin: 0px 5px 5px 5px;
	padding: 0px;
}
ul.toc li {
	font-size: 85%;
	margin: 1px 0 1px 1px;
	padding: 1px 0 1px 11px;
	list-style-type: none;
	background-repeat: no-repeat;
	background-position: center left;
}
ul.toc li.header {
	font-size: 115%;
	padding: 5px 0px 5px 11px;
	border-bottom: 1px solid #cccccc;
	margin-bottom: 5px;
}
ul.toc li.active {
	font-weight: bold;
}
ul.toc li a {
	text-decoration: none;
}
ul.toc li a:hover {
	text-decoration: underline;
}
</style>
 <ul class="toc">
  <li class="header home"><a href="manual.html">Programmer's Reference Guide</a></li>
  <li class="header up"><a href="manual.html">Programmer's Reference Guide</a></li>
  <li class="header up"><a href="reference.html">Zend Framework Reference</a></li>
  <li class="header up"><a href="zend.session.html">Zend_Session</a></li>
  <li><a href="zend.session.introduction.html">Введение</a></li>
  <li><a href="zend.session.basicusage.html">Базовое использованиеBasic Usage</a></li>
  <li><a href="zend.session.advanced_usage.html">Расширенное использование</a></li>
  <li class="active"><a href="zend.session.globalsessionmanagement.html">Общее управление сессиямиGlobal Session Management</a></li>
  <li><a href="zend.session.savehandler.dbtable.html">Zend_Session_SaveHandler_DbTable</a></li>
 </ul>
 </td>
    </tr>
</table>
</body>
</html>