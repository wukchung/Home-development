<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>レスポンスオブジェクト - Zend Framework Manual</title>

</head>
<body>
<table width="100%">
    <tr valign="top">
        <td width="85%">
            <table width="100%">
                <tr>
                    <td width="25%" style="text-align: left;">
                    <a href="zend.controller.actionhelpers.html">アクションヘルパー</a>
                    </td>

                    <td width="50%" style="text-align: center;">
                        <div class="up"><span class="up"><a href="zend.controller.html">Zend_Controller</a></span><br />
                        <span class="home"><a href="manual.html">Programmer's Reference Guide</a></span></div>
                    </td>

                    <td width="25%" style="text-align: right;">
                        <div class="next" style="text-align: right; float: right;"><a href="zend.controller.plugins.html">プラグイン</a></div>
                    </td>
                </tr>
            </table>
<hr />
<div id="zend.controller.response" class="section"><div class="info"><h1 class="title">レスポンスオブジェクト</h1></div>
    

    <div class="section" id="zend.controller.response.usage" name="zend.controller.response.usage"><div class="info"><h1 class="title">使用法</h1></div>
        

        <p class="para">
            レスポンスオブジェクトは、
            <a href="zend.controller.request.html" class="link">リクエストオブジェクト</a>
            と対になるものです。
            その目的は、コンテンツやヘッダを収集し、それを返すことです。
            さらに、フロントコントローラで捕捉した例外はすべてレスポンスオブジェクトに渡されます。
            これにより、例外の処理がやりやすくなります。
            この挙動を変更するには
             <span class="methodname">Zend_Controller_Front::throwExceptions(true)</span>
            と設定します。
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">throwExceptions</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            ヘッダを含むレスポンス出力を送信するには、
             <span class="methodname">sendResponse()</span> を使用します。
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">sendResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <blockquote><p><b class="note">Note</b>: 
            
                デフォルトでは、リクエストのディスパッチに終了した時点でフロントコントローラが
                 <span class="methodname">sendResponse()</span> をコールします。通常はこれをコールする必要はありません。
                しかし、テスト中などにレスポンスの内容を操作したい場合は、
                <span class="property">returnResponse</span> フラグを
                 <span class="methodname">Zend_Controller_Front::returnResponse(true)</span>
                と設定することでこの振る舞いを変更できます。
            <br />

            <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">returnResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span> = <span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">dispatch</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// 何かの処理、たとえばログの記録などを行ってから</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// 結果を出力します</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">sendResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>

        </p></blockquote>

        <p class="para">
            開発者は、アクションコントローラの中でレスポンスオブジェクトを使用しなければなりません。
            出力を直接レンダリングしたり直接ヘッダを送信したりするのではなく、
            それらをレスポンスオブジェクトに格納するようにします。
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// アクションコントローラのアクション内で、</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// ヘッダを設定します</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$this</span>-&gt;<span style="color: #006600;">getResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; -&gt;<span style="color: #006600;">setHeader</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'Content-Type'</span>, <span style="color: #ff0000;">'text/html'</span><span style="color: #66cc66;">&#41;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; -&gt;<span style="color: #006600;">appendBody</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$content</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            こうすることで、すべてのヘッダを一度に送信し、
            その後でコンテンツを表示することができます。
        </p>

        <blockquote><p><b class="note">Note</b>: 
            
                アクションコントローラで <a href="zend.controller.action.html#zend.controller.action.viewintegration" class="link">ビューの統合
                    </a> を使用する場合は、
                レンダリングされたビュースクリプトの内容をレスポンスオブジェクトに設定する必要はありません。
                 <span class="methodname">Zend_Controller_Action::render()</span> がデフォルトでこれを行います。
            <br />
        </p></blockquote>

        <p class="para">
            アプリケーションで例外が発生したかどうかを調べるには、
            レスポンスオブジェクトの  <span class="methodname">isException()</span>
            フラグを調べます。例外を取得するには  <span class="methodname">getException()</span>
            を使用します。さらに、独自のレスポンスオブジェクトを作成して、
            エラーページへのリダイレクトや例外メッセージのログ出力、
            例外をわかりやすく表示する (開発用) などを行うことができます。
        </p>

        <p class="para">
            レスポンスオブジェクトは、フロントコントローラの
             <span class="methodname">dispatch()</span> から受け取ることになります。あるいは、
            出力のレンダリングを行わない状態のレスポンスオブジェクトを
            フロントコントローラから受け取ることもできます。
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// dispatch の後に取得します</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">dispatch</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span> = <span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">getResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #b1b100;">if</span> <span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">isException</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #808080; font-style: italic;">// ログへの記録、メール送信など...</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// あるいは、フロントコントローラの dispatch() の返り値を使用します</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">returnResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span> = <span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">dispatch</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// 何かの処理...</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// 最後に結果を表示します</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">sendResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            デフォルトでは、例外メッセージは表示されません。
            この挙動をオーバーライドするには  <span class="methodname">renderExceptions()</span>
            メソッドを使用するか、あるいは上で示したようにフロントコントローラで
             <span class="methodname">throwExceptions()</span> を有効にします。
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">renderExceptions</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">dispatch</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$request</span>, <span style="color: #0000ff;">$response</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// あるいは</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">returnResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span> = <span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">dispatch</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">renderExceptions</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">sendResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// あるいは</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">throwExceptions</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$front</span>-&gt;<span style="color: #006600;">dispatch</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>

    </div>

    <div class="section" id="zend.controller.response.headers" name="zend.controller.response.headers"><div class="info"><h1 class="title">ヘッダの操作</h1></div>
        

        <p class="para">
            先ほど説明したように、レスポンスオブジェクトの役割のひとつは
            <acronym class="acronym">HTTP</acronym> レスポンスヘッダを発行することです。
            このために、さまざまなメソッドが用意されています。
        </p>

        <ul class="itemizedlist">
            <li class="listitem">
                <p class="para">
                     <span class="methodname">canSendHeaders()</span> を使用して、
                    ヘッダがすでに送信されているかどうかを調べます。
                    オプションのフラグで、ヘッダが送信済みの場合に例外をスローするかどうかを指定します。
                    この設定は、プロパティ <span class="property">headersSentThrowsException</span>
                    を <b><tt>FALSE</tt></b> にすることで上書きできます。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">setHeader($name, $value, $replace = false)</span>
                    を使用して、個々のヘッダを設定します。デフォルトでは、
                    同名のヘッダがすでに存在した場合に既存のヘッダを置換することはありません。
                    しかし、<var class="varname">$replace</var> を <b><tt>TRUE</tt></b> に設定すると、
                    既存のヘッダを上書きするようになります。
                </p>

                <p class="para">
                    ヘッダを設定する前に、このメソッドは
                     <span class="methodname">canSendHeaders()</span> を使用して
                    ヘッダが現時点で送信済みでないかどうか、例外をスローするかどうかを調べます。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">setRedirect($url, $code = 302)</span> は、
                    リダイレクト用の <acronym class="acronym">HTTP</acronym> Location ヘッダを設定します。
                    <acronym class="acronym">HTTP</acronym> ステータスコードを指定した場合は、そのコードを使用します。
                </p>

                <p class="para">
                    内部的には、このメソッドは
                    <var class="varname">$replace</var> フラグをオンにして
                     <span class="methodname">setHeader()</span> をコールしています。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">getHeaders()</span> は、すべてのヘッダを配列で返します。
                    個々の配列の要素は、&#039;name&#039; および &#039;value&#039;
                    のふたつのキーを持つ配列となります。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">clearHeaders()</span> は登録済みのヘッダをすべて削除します。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">setRawHeader()</span>
                    を使用して、キー/値 の組になっていないヘッダを設定します。
                    たとえば <acronym class="acronym">HTTP</acronym> status ヘッダなどがこれにあたります。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">getRawHeaders()</span> は、登録済みの生のヘッダを返します。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">clearRawHeaders()</span> は、登録済みの生のヘッダを消去します。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">clearAllHeaders()</span> は、キー/値 のペアである通常のヘッダと
                    生のヘッダの両方を消去します。
                </p>
            </li>
        </ul>

        <p class="para">
            これらのメソッドのほかに、現在のリクエストの <acronym class="acronym">HTTP</acronym>
            レスポンスコードを設定したり取得したりするメソッドとして
             <span class="methodname">setHttpResponseCode()</span> と
             <span class="methodname">getHttpResponseCode()</span> が用意されています。
        </p>
    </div>

    <div class="section" id="zend.controller.response.namedsegments" name="zend.controller.response.namedsegments"><div class="info"><h1 class="title">名前つきセグメント</h1></div>
        

        <p class="para">
            レスポンスオブジェクトでは「名前つきセグメント」をサポートしています。
            これにより、本文部だけを別のセグメントに切り分けて、
            指定した順序で出力したりといったことができるようになります。
            内部的にはコンテンツは配列として保存され、
            さまざまなメソッドを使用してその配列にアクセスできるようになります。
        </p>

        <p class="para">
            例として、 <span class="methodname">preDispatch()</span> フックメソッドで
            レスポンスオブジェクトにヘッダを追加し、
            アクションコントローラで本文を追加して、
            最後に  <span class="methodname">postDispatch()</span> フックメソッドでフッタを追加することを考えてみましょう。
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// このプラグインクラスがフロントコントローラで登録済みであると仮定します</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #000000; font-weight: bold;">class</span> MyPlugin <span style="color: #000000; font-weight: bold;">extends</span> Zend_Controller_Plugin_Abstract</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> preDispatch<span style="color: #66cc66;">&#40;</span>Zend_Controller_Request_Abstract <span style="color: #0000ff;">$request</span><span style="color: #66cc66;">&#41;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$response</span> = <span style="color: #0000ff;">$this</span>-&gt;<span style="color: #006600;">getResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$view</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_View<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$view</span>-&gt;<span style="color: #006600;">setBasePath</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'../views/scripts'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">prepend</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'header'</span>, <span style="color: #0000ff;">$view</span>-&gt;<span style="color: #006600;">render</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'header.phtml'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> postDispatch<span style="color: #66cc66;">&#40;</span>Zend_Controller_Request_Abstract <span style="color: #0000ff;">$request</span><span style="color: #66cc66;">&#41;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$response</span> = <span style="color: #0000ff;">$this</span>-&gt;<span style="color: #006600;">getResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$view</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_View<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$view</span>-&gt;<span style="color: #006600;">setBasePath</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'../views/scripts'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">append</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'footer'</span>, <span style="color: #0000ff;">$view</span>-&gt;<span style="color: #006600;">render</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'footer.phtml'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// アクションコントローラの例</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #000000; font-weight: bold;">class</span> MyController <span style="color: #000000; font-weight: bold;">extends</span> Zend_Controller_Action</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> fooAction<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$this</span>-&gt;<span style="color: #006600;">render</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#125;</span></div></li></ol></div></div></div>


        <p class="para">
            上の例で <var class="filename">/my/foo</var> をコールすると、
            レスポンスオブジェクトに最終的に格納されるコンテンツは次のようになります。
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">&#40;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #ff0000;">'header'</span>&nbsp; =&gt; ..., <span style="color: #808080; font-style: italic;">// ヘッダの内容</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #ff0000;">'default'</span> =&gt; ..., <span style="color: #808080; font-style: italic;">// MyController::fooAction() が作成した本文</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #ff0000;">'footer'</span>&nbsp; =&gt; ...&nbsp; <span style="color: #808080; font-style: italic;">// フッタの内容</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            これをレンダリングすると、配列に要素が追加された順に表示されます。
        </p>

        <p class="para">
            名前つきセグメントを操作するメソッドには、以下のようなものがあります。
        </p>

        <ul class="itemizedlist">
            <li class="listitem">
                <p class="para">
                     <span class="methodname">setBody()</span> および  <span class="methodname">appendBody()</span>
                    の二番目のパラメータである <var class="varname">$name</var>
                    に、セグメント名を渡すことができます。
                    これを指定すると、指定したセグメントの内容を上書きします
                    (存在しない場合は新たに作成し、配列に追加します)。
                     <span class="methodname">setBody()</span> にセグメント名を指定しなかった場合は、
                    配列全体を初期化します。 <span class="methodname">appendBody()</span>
                    でセグメント名を省略した場合は、&#039;default&#039;
                    という名前のセグメントを追加します。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">prepend($name, $content)</span> は、
                    <var class="varname">$name</var> という名前のセグメントを作成して、
                    それを配列の先頭に追加します。同じ名前のセグメントが存在する場合は、
                    まずそれを削除してから追加します(つまり、既存のものを上書きします)。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">append($name, $content)</span> は、
                    <var class="varname">$name</var> という名前のセグメントを作成して、
                    それを配列の最後に追加します。同じ名前のセグメントが存在する場合は、
                    まずそれを削除してから追加します(つまり、既存のものを上書きします)。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">insert($name, $content, $parent = null, $before =
                        false)</span> は、<var class="varname">$name</var> という名前のセグメントを作成します。
                    <var class="varname">$parent</var> セグメントを指定すると、
                    新しいセグメントはそのセグメントの前か後ろ
                    (<var class="varname">$before</var> の値で決まります)
                    に配置されます。同じ名前のセグメントが存在する場合は、
                    まずそれを削除してから追加します(つまり、既存のものを上書きします)。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">clearBody($name = null)</span>
                    に <var class="varname">$name</var> を指定すると、その名前のセグメントを消去します
                    (省略した場合は、配列全体を消去します)。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">getBody($spec = false)</span> で
                    <var class="varname">$spec</var> にセグメント名を指定すると、そのセグメントを取得できます。
                    <var class="varname">$spec</var> に <b><tt>FALSE</tt></b> を指定すると、
                    すべてのセグメントの内容を順番に連結した結果を文字列で返します。
                    <var class="varname">$spec</var> に <b><tt>TRUE</tt></b> を指定すると、本文の配列を返します。
                </p>
            </li>
        </ul>
    </div>

    <div class="section" id="zend.controller.response.exceptions" name="zend.controller.response.exceptions"><div class="info"><h1 class="title">レスポンスオブジェクト内での例外の検査</h1></div>
        

        <p class="para">
            先ほど説明したように、デフォルトでは
            ディスパッチ中に発生した例外はレスポンスオブジェクトに登録されます。
            例外はスタックに登録されるので、発生した例外はすべて保持することができます。
            アプリケーションの例外、ディスパッチ処理の例外、プラグインの例外などなど……。
            特定の例外の内容を調べたり例外をログに記録したりしたい場合は、
            レスポンスオブジェクトの例外用 <acronym class="acronym">API</acronym> を使用します。
        </p>

        <ul class="itemizedlist">
            <li class="listitem">
                <p class="para">
                     <span class="methodname">setException(Exception $e)</span>
                    は、例外を登録します。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">isException()</span>
                    は、例外が登録されているかどうかを調べます。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">getException()</span>
                    は、例外スタック全体を返します。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">hasExceptionOfType($type)</span>
                    は、特定のクラスの例外がスタックに登録されているかどうかを調べます。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">hasExceptionOfMessage($message)</span>
                    は、指定したメッセージを含む例外が
                    スタックに登録されているかどうかを調べます。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">hasExceptionOfCode($code)</span>
                    は、指定したコードを含む例外が
                    スタックに登録されているかどうかを調べます。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">getExceptionByType($type)</span>
                    は、指定したクラスの例外をスタックからすべて取り出します。
                    そのクラスの例外が見つからなかった場合は <b><tt>FALSE</tt></b> を返し、
                    見つかった場合は例外の配列を返します。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">getExceptionByMessage($message)</span>
                    は、指定したメッセージを含む例外をスタックからすべて取り出します。
                    そのクラスの例外が見つからなかった場合は <b><tt>FALSE</tt></b> を返し、
                    見つかった場合は例外の配列を返します。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">getExceptionByCode($code)</span>
                    は、指定したコードを含む例外をスタックからすべて取り出します。
                    そのクラスの例外が見つからなかった場合は <b><tt>FALSE</tt></b> を返し、
                    見つかった場合は例外の配列を返します。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">renderExceptions($flag)</span>
                    は、例外が発生したかどうかを表すフラグを設定します。
                </p>
            </li>
        </ul>
    </div>

    <div class="section" id="zend.controller.response.subclassing" name="zend.controller.response.subclassing"><div class="info"><h1 class="title">レスポンスオブジェクトのサブクラスの作成</h1></div>
        

        <p class="para">
            レスポンスオブジェクトの役割は、
            さまざまなアクションやプラグインからヘッダやコンテンツを収集し、
            それをクライアントに返すことです。
            さらに、処理中に発生したエラーの内容も収集します。
            これはそのまま返すこともありますし、あるいはユーザから見えないように隠すこともあります。
        </p>

        <p class="para">
            レスポンスクラスの基底クラスは
            <span class="classname">Zend_Controller_Response_Abstract</span>
            です。レスポンスクラスを作成する際には、
            このクラスあるいはその派生クラスのいずれかを継承しなければなりません。
            このクラスが提供するメソッドについては、先ほど説明しました。
        </p>

        <p class="para">
            レスポンスオブジェクトのサブクラスを作成する理由としては、
            リクエストされた環境に応じて出力内容を変えたり
            (たとえば <acronym class="acronym">CLI</acronym> や
            <acronym class="acronym">PHP</acronym>-<acronym class="acronym">GTK</acronym> の場合はヘッダを送信しないなど)
            名前つきセグメントに保存された内容の最終結果を返す機能を追加したりといったことが考えられます。
        </p>
    </div>
</div>
        <hr />

            <table width="100%">
                <tr>
                    <td width="25%" style="text-align: left;">
                    <a href="zend.controller.actionhelpers.html">アクションヘルパー</a>
                    </td>

                    <td width="50%" style="text-align: center;">
                        <div class="up"><span class="up"><a href="zend.controller.html">Zend_Controller</a></span><br />
                        <span class="home"><a href="manual.html">Programmer's Reference Guide</a></span></div>
                    </td>

                    <td width="25%" style="text-align: right;">
                        <div class="next" style="text-align: right; float: right;"><a href="zend.controller.plugins.html">プラグイン</a></div>
                    </td>
                </tr>
            </table>
</td>
        <td style="font-size: smaller;" width="15%"> <style type="text/css">
#leftbar {
	float: left;
	width: 186px;
	padding: 5px;
	font-size: smaller;
}
ul.toc {
	margin: 0px 5px 5px 5px;
	padding: 0px;
}
ul.toc li {
	font-size: 85%;
	margin: 1px 0 1px 1px;
	padding: 1px 0 1px 11px;
	list-style-type: none;
	background-repeat: no-repeat;
	background-position: center left;
}
ul.toc li.header {
	font-size: 115%;
	padding: 5px 0px 5px 11px;
	border-bottom: 1px solid #cccccc;
	margin-bottom: 5px;
}
ul.toc li.active {
	font-weight: bold;
}
ul.toc li a {
	text-decoration: none;
}
ul.toc li a:hover {
	text-decoration: underline;
}
</style>
 <ul class="toc">
  <li class="header home"><a href="manual.html">Programmer's Reference Guide</a></li>
  <li class="header up"><a href="manual.html">Programmer's Reference Guide</a></li>
  <li class="header up"><a href="reference.html">Zend Framework Reference</a></li>
  <li class="header up"><a href="zend.controller.html">Zend_Controller</a></li>
  <li><a href="zend.controller.quickstart.html">Zend_Controller クイックスタート</a></li>
  <li><a href="zend.controller.basics.html">Zend_Controller の基本</a></li>
  <li><a href="zend.controller.front.html">フロントコントローラ</a></li>
  <li><a href="zend.controller.request.html">リクエストオブジェクト</a></li>
  <li><a href="zend.controller.router.html">標準のルータ</a></li>
  <li><a href="zend.controller.dispatcher.html">ディスパッチャ</a></li>
  <li><a href="zend.controller.action.html">アクションコントローラ</a></li>
  <li><a href="zend.controller.actionhelpers.html">アクションヘルパー</a></li>
  <li class="active"><a href="zend.controller.response.html">レスポンスオブジェクト</a></li>
  <li><a href="zend.controller.plugins.html">プラグイン</a></li>
  <li><a href="zend.controller.modular.html">モジュラーディレクトリ構造の規約の使用</a></li>
  <li><a href="zend.controller.exceptions.html">MVC での例外</a></li>
 </ul>
 </td>
    </tr>
</table>
</body>
</html>