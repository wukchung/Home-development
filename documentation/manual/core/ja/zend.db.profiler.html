<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>Zend_Db_Profiler(日本語) - Zend Framework Manual</title>

</head>
<body>
<table width="100%">
    <tr valign="top">
        <td width="85%">
            <table width="100%">
                <tr>
                    <td width="25%" style="text-align: left;">
                    <a href="zend.db.statement.html">Zend_Db_Statement(日本語)</a>
                    </td>

                    <td width="50%" style="text-align: center;">
                        <div class="up"><span class="up"><a href="zend.db.html">Zend_Db</a></span><br />
                        <span class="home"><a href="manual.html">Programmer's Reference Guide</a></span></div>
                    </td>

                    <td width="25%" style="text-align: right;">
                        <div class="next" style="text-align: right; float: right;"><a href="zend.db.select.html">Zend_Db_Select(日本語)</a></div>
                    </td>
                </tr>
            </table>
<hr />
<div id="zend.db.profiler" class="section"><div class="info"><h1 class="title">Zend_Db_Profiler(日本語)</h1></div>

    

    <div class="section" id="zend.db.profiler.introduction" name="zend.db.profiler.introduction"><div class="info"><h1 class="title">導入</h1></div>

        

        <p class="para">
            <span class="classname">Zend_Db_Profiler</span> を使用すると、クエリの情報を取得できます。
            アダプタが実際に実行したクエリの内容や実行所要時間などが取得でき、
            余計なデバッグコードをクラスに追加しなくてもクエリを調べられるようになります。
            さらに、条件を指定して特定のクエリだけの情報を取得することもできます。
        </p>

        <p class="para">
            プロファイラを有効にするには、アダプタのコンストラクタで指定するか、
            あるいは後からアダプタに指示します。
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$params</span> = <a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">&#40;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #ff0000;">'host'</span>&nbsp; &nbsp; &nbsp;=&gt; <span style="color: #ff0000;">'127.0.0.1'</span>,</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #ff0000;">'username'</span> =&gt; <span style="color: #ff0000;">'webuser'</span>,</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #ff0000;">'password'</span> =&gt; <span style="color: #ff0000;">'xxxxxxxx'</span>,</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #ff0000;">'dbname'</span>&nbsp; &nbsp;=&gt; <span style="color: #ff0000;">'test'</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #ff0000;">'profiler'</span> =&gt; <span style="color: #000000; font-weight: bold;">true</span>&nbsp; <span style="color: #808080; font-style: italic;">// プロファイラを使用します。</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;">// false (デフォルト) にすると無効になります。</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$db</span> = Zend_Db::<span style="color: #006600;">factory</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'PDO_MYSQL'</span>, <span style="color: #0000ff;">$params</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// プロファイラを無効にします</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$db</span>-&gt;<span style="color: #006600;">getProfiler</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>-&gt;<span style="color: #006600;">setEnabled</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">false</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// プロファイラを有効にします</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$db</span>-&gt;<span style="color: #006600;">getProfiler</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>-&gt;<span style="color: #006600;">setEnabled</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            <span class="property">profiler</span> オプションの値には柔軟性があり、
            その型に応じて、さまざまな形式で解釈されます。
            たいていは単純な boolean 値を指定することになるでしょうが、
            その他の型を指定することでプロファイラの振る舞いをカスタマイズすることも可能です。
        </p>

        <p class="para">
            boolean 引数 <b><tt>TRUE</tt></b> を指定すると、
            プロファイラを有効にします。あるいは <b><tt>FALSE</tt></b>
            にすると、プロファイラを無効にします。プロファイラのクラスは、
            そのアダプタのデフォルトのプロファイラクラスである
            <span class="classname">Zend_Db_Profiler</span> となります。
        </p>

<div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$params</span><span style="color: #66cc66;">&#91;</span><span style="color: #ff0000;">'profiler'</span><span style="color: #66cc66;">&#93;</span> = <span style="color: #000000; font-weight: bold;">true</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$db</span> = Zend_Db::<span style="color: #006600;">factory</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'PDO_MYSQL'</span>, <span style="color: #0000ff;">$params</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            プロファイラオブジェクトのインスタンスを、アダプタで使用します。
            このオブジェクトの型は、<span class="classname">Zend_Db_Profiler</span>
            あるいはそのサブクラスでなければなりません。
            プロファイラを有効にするには、次にようにします。
        </p>

<div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$profiler</span> = MyProject_Db_Profiler<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$profiler</span>-&gt;<span style="color: #006600;">setEnabled</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$params</span><span style="color: #66cc66;">&#91;</span><span style="color: #ff0000;">'profiler'</span><span style="color: #66cc66;">&#93;</span> = <span style="color: #0000ff;">$profiler</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$db</span> = Zend_Db::<span style="color: #006600;">factory</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'PDO_MYSQL'</span>, <span style="color: #0000ff;">$params</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            引数は連想配列で、&#039;<span class="property">enabled</span>&#039;、
            &#039;<span class="property">instance</span>&#039; および &#039;<span class="property">class</span>&#039;
            のいずれか (あるいはすべて) のキーを持ちます。
            &#039;<span class="property">enabled</span>&#039; と &#039;<span class="property">instance</span>&#039; は、
            それぞれ boolean および上で説明したインスタンスです。
            &#039;<span class="property">class</span>&#039; は、独自のプロファイラを使用する場合のクラス名を指定します。
            このクラスは <span class="classname">Zend_Db_Profiler</span> あるいはそのサブクラスでなければなりません。
            このクラスは、コンストラクタに何も引数を渡さないでインスタンス化されます。
            &#039;<span class="property">class</span>&#039; の内容は、
            &#039;<span class="property">instance</span>&#039; を指定した際には無視されます。
        </p>

<div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$params</span><span style="color: #66cc66;">&#91;</span><span style="color: #ff0000;">'profiler'</span><span style="color: #66cc66;">&#93;</span> = <a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">&#40;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #ff0000;">'enabled'</span> =&gt; <span style="color: #000000; font-weight: bold;">true</span>,</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #ff0000;">'class'</span>&nbsp; &nbsp;=&gt; <span style="color: #ff0000;">'MyProject_Db_Profiler'</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$db</span> = Zend_Db::<span style="color: #006600;">factory</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'PDO_MYSQL'</span>, <span style="color: #0000ff;">$params</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            また、引数は <span class="classname">Zend_Config</span> のオブジェクトで渡すこともできます。
            このオブジェクトのプロパティが、先ほどの連想配列のキーと同じように解釈されます。
            たとえば、次のような内容の &quot;<var class="filename">config.ini</var>&quot; ファイルがあったとしましょう。
        </p>

<div class="programlisting ini"><div class="inicode"><div class="ini" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #000066; font-weight:bold;"><span style="">&#91;</span>main<span style="">&#93;</span></span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">db.profiler.<span style="color: #000099;">class&nbsp; &nbsp;</span>= <span style="color: #933;">&quot;MyProject_Db_Profiler&quot;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">db.profiler.<span style="color: #000099;">enabled </span>=<span style="color: #660066;"> true</span></div></li></ol></div></div></div>


        <p class="para">
            この設定を適用するには、次のような <acronym class="acronym">PHP</acronym> コードを書きます。
        </p>

<div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$config</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_Config_Ini<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'config.ini'</span>, <span style="color: #ff0000;">'main'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$params</span><span style="color: #66cc66;">&#91;</span><span style="color: #ff0000;">'profiler'</span><span style="color: #66cc66;">&#93;</span> = <span style="color: #0000ff;">$config</span>-&gt;<span style="color: #006600;">db</span>-&gt;<span style="color: #006600;">profiler</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$db</span> = Zend_Db::<span style="color: #006600;">factory</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'PDO_MYSQL'</span>, <span style="color: #0000ff;">$params</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            &#039;<span class="property">instance</span>&#039; プロパティは、次のように使用します。
        </p>

<div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$profiler</span> = <span style="color: #000000; font-weight: bold;">new</span> MyProject_Db_Profiler<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$profiler</span>-&gt;<span style="color: #006600;">setEnabled</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$configData</span> = <a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">&#40;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #ff0000;">'instance'</span> =&gt; <span style="color: #0000ff;">$profiler</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$config</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_Config<span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$configData</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$params</span><span style="color: #66cc66;">&#91;</span><span style="color: #ff0000;">'profiler'</span><span style="color: #66cc66;">&#93;</span> = <span style="color: #0000ff;">$config</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$db</span> = Zend_Db::<span style="color: #006600;">factory</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'PDO_MYSQL'</span>, <span style="color: #0000ff;">$params</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


    </div>

    <div class="section" id="zend.db.profiler.using" name="zend.db.profiler.using"><div class="info"><h1 class="title">プロファイラの使用</h1></div>

        

        <p class="para">
            好きなところでアダプタの
             <span class="methodname">getProfiler()</span> メソッドを使用すれば、
            プロファイラを取得できます。
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$profiler</span> = <span style="color: #0000ff;">$db</span>-&gt;<span style="color: #006600;">getProfiler</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            これは、<span class="classname">Zend_Db_Profiler</span> オブジェクトのインスタンスを返します。
            このインスタンスのさまざまなメソッドを使用することで、
            クエリの内容を調べることができます。
        </p>

        <ul class="itemizedlist">
            <li class="listitem">
                <p class="para">
                     <span class="methodname">getTotalNumQueries()</span> は、
                    情報を取得したクエリの総数を返します。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">getTotalElapsedSecs()</span> は、
                    情報を取得したクエリの実行所要時間の合計を返します。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">getQueryProfiles()</span> は、
                    すべてのクエリ情報を配列で返します。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">getLastQueryProfile()</span> は、最後に
                    (直近に) 実行されたクエリの情報を (そのクエリが
                    完了したか否かにかかわらず) 返します
                    (クエリが完了していない場合は、終了時刻が <b><tt>NULL</tt></b> となります)。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">clear()</span> は、スタック上に残っている
                    過去のクエリ情報をすべて消去します。
                </p>
            </li>
        </ul>

        <p class="para">
             <span class="methodname">getLastQueryProfile()</span> の返り値、および
             <span class="methodname">getQueryProfiles()</span> の個々の要素は
            <span class="classname">Zend_Db_Profiler_Query</span> オブジェクトで、
            これを使用すると個々のクエリ自体の情報を調べられます。
        </p>

        <ul class="itemizedlist">
            <li class="listitem">
                <p class="para">
                     <span class="methodname">getQuery()</span> は、クエリの <acronym class="acronym">SQL</acronym> テキストを返します。
                    パラメータつきのプリペアドステートメントの場合、
                    クエリがプリペアされた時点のテキストを返します。
                    つまり、プレースホルダを含んだままの形式ということです。
                    実行時に置き換えられた値を知ることはできません。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">getQueryParams()</span> は、
                    プリペアドクエリを実行する際に使用する、パラメータの値の配列を返します。
                    ここには、バインドパラメータだけでなく
                     <span class="methodname">execute()</span> メソッドへの引数も含まれます。
                    配列のキーは、(1 から始まる) 数値かあるいは (文字列の) パラメータ名となります。
                </p>
            </li>

            <li class="listitem">
                <p class="para">
                     <span class="methodname">getElapsedSecs()</span> は、
                    クエリの実行所要時間を返します。
                </p>
            </li>
        </ul>

        <p class="para">
            <span class="classname">Zend_Db_Profiler</span> の提供する情報は、
            アプリケーションのボトルネックを調査したり
            クエリをデバッグしたりする場合に有用です。
            例えば、直近に実行されたクエリが実際のところどんなものだったのかを知るには次のようにします。
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$query</span> = <span style="color: #0000ff;">$profiler</span>-&gt;<span style="color: #006600;">getLastQueryProfile</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/echo"><span style="color: #000066;">echo</span></a> <span style="color: #0000ff;">$query</span>-&gt;<span style="color: #006600;">getQuery</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            ページの生成に時間がかかっているとしましょう。この場合、
            プロファイラを使用してまず全クエリの実行所要秒数を取得します。
            それから、個々のクエリを調べ、一番時間がかかっているのはどれかを見つけます。
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$totalTime</span>&nbsp; &nbsp; = <span style="color: #0000ff;">$profiler</span>-&gt;<span style="color: #006600;">getTotalElapsedSecs</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$queryCount</span>&nbsp; &nbsp;= <span style="color: #0000ff;">$profiler</span>-&gt;<span style="color: #006600;">getTotalNumQueries</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$longestTime</span>&nbsp; = <span style="color: #cc66cc;">0</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$longestQuery</span> = <span style="color: #000000; font-weight: bold;">null</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #b1b100;">foreach</span> <span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$profiler</span>-&gt;<span style="color: #006600;">getQueryProfiles</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span> <span style="color: #b1b100;">as</span> <span style="color: #0000ff;">$query</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$query</span>-&gt;<span style="color: #006600;">getElapsedSecs</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span> &gt; <span style="color: #0000ff;">$longestTime</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$longestTime</span>&nbsp; = <span style="color: #0000ff;">$query</span>-&gt;<span style="color: #006600;">getElapsedSecs</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$longestQuery</span> = <span style="color: #0000ff;">$query</span>-&gt;<span style="color: #006600;">getQuery</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/echo"><span style="color: #000066;">echo</span></a> <span style="color: #ff0000;">'全部で '</span> . <span style="color: #0000ff;">$queryCount</span> . <span style="color: #ff0000;">' 件のクエリが '</span> . <span style="color: #0000ff;">$totalTime</span> .</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">' 秒で実行されました'</span> . <span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/echo"><span style="color: #000066;">echo</span></a> <span style="color: #ff0000;">'平均の所要時間: '</span> . <span style="color: #0000ff;">$totalTime</span> / <span style="color: #0000ff;">$queryCount</span> . <span style="color: #ff0000;">' 秒'</span> . <span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/echo"><span style="color: #000066;">echo</span></a> <span style="color: #ff0000;">'1 秒あたりのクエリ実行数: '</span> . <span style="color: #0000ff;">$queryCount</span> / <span style="color: #0000ff;">$totalTime</span> . <span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/echo"><span style="color: #000066;">echo</span></a> <span style="color: #ff0000;">'所要時間の最大値: '</span> . <span style="color: #0000ff;">$longestTime</span> . <span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/echo"><span style="color: #000066;">echo</span></a> <span style="color: #ff0000;">&quot;一番時間のかかっているクエリ: <span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> . <span style="color: #0000ff;">$longestQuery</span> . <span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span>;</div></li></ol></div></div></div>


    </div>

    <div class="section" id="zend.db.profiler.advanced" name="zend.db.profiler.advanced"><div class="info"><h1 class="title">プロファイラの高度な使用法</h1></div>

        

        <p class="para">
            単にクエリを調べるだけでなく、どのクエリを調べるのかという
            条件を指定することも可能です。以下で説明するメソッドは、
            <span class="classname">Zend_Db_Profiler</span> インスタンスのメソッドです。
        </p>

        <div class="section" id="zend.db.profiler.advanced.filtertime" name="zend.db.profiler.advanced.filtertime"><div class="info"><h1 class="title">クエリの実行所要時間による絞り込み</h1></div>
            

            <p class="para">
                 <span class="methodname">setFilterElapsedSecs()</span> は、クエリの情報を取得する条件として
                実行所要時間の最小値を指定します。このフィルタを削除するには、
                メソッドに <b><tt>NULL</tt></b> 値を渡します。
            </p>

            <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// 所要時間が 5 秒以上のクエリのみ調べます</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$profiler</span>-&gt;<span style="color: #006600;">setFilterElapsedSecs</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">5</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// 所要時間にかかわらず、すべてのクエリを調べます</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$profiler</span>-&gt;<span style="color: #006600;">setFilterElapsedSecs</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">null</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>

        </div>

        <div class="section" id="zend.db.profiler.advanced.filtertype" name="zend.db.profiler.advanced.filtertype"><div class="info"><h1 class="title">クエリの形式による絞り込み</h1></div>
            

            <p class="para">
                 <span class="methodname">setFilterQueryType()</span> は、クエリの情報を取得する条件として
                クエリの形式を指定します。複数の形式を扱うには、それらの論理 OR を指定します。
                クエリの形式は、<span class="classname">Zend_Db_Profiler</span>
                のクラス定数として以下のように定義されています。
            </p>

            <ul class="itemizedlist">
                <li class="listitem">
                    <p class="para">
                        <b><tt>Zend_Db_Profiler::CONNECT</tt></b>:
                        接続操作、あるいはデータベースの選択。
                    </p>
                </li>

                <li class="listitem">
                    <p class="para">
                        <b><tt>Zend_Db_Profiler::QUERY</tt></b>:
                        他の形式にあてはまらないクエリ。
                    </p>
                </li>

                <li class="listitem">
                    <p class="para">
                        <b><tt>Zend_Db_Profiler::INSERT</tt></b>:
                        新しいデータをデータベースに追加するクエリ。
                        一般的には <acronym class="acronym">SQL</acronym> の <acronym class="acronym">INSERT</acronym>。
                    </p>
                </li>

                <li class="listitem">
                    <p class="para">
                        <b><tt>Zend_Db_Profiler::UPDATE</tt></b>:
                        既存のデータを更新するクエリ。通常は <acronym class="acronym">SQL</acronym> の <acronym class="acronym">UPDATE</acronym>。
                    </p>
                </li>

                <li class="listitem">
                    <p class="para">
                        <b><tt>Zend_Db_Profiler::DELETE</tt></b>:
                        既存のデータを削除するクエリ。通常は <acronym class="acronym">SQL</acronym> の <b><tt>DELETE</tt></b>。
                    </p>
                </li>

                <li class="listitem">
                    <p class="para">
                        <b><tt>Zend_Db_Profiler::SELECT</tt></b>:
                        既存のデータを取得するクエリ。通常は <acronym class="acronym">SQL</acronym> の <acronym class="acronym">SELECT</acronym>。
                    </p>
                </li>

                <li class="listitem">
                    <p class="para">
                        <b><tt>Zend_Db_Profiler::TRANSACTION</tt></b>:
                        トランザクションに関する操作。例えばトランザクションの開始や
                        コミット、ロールバックなど。
                    </p>
                </li>
            </ul>

            <p class="para">
                既存のフィルタを削除するには、
                 <span class="methodname">setFilterElapsedSecs()</span> の引数に
                <b><tt>NULL</tt></b> だけを渡します。
            </p>

            <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// SELECT クエリのみを調べます</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$profiler</span>-&gt;<span style="color: #006600;">setFilterQueryType</span><span style="color: #66cc66;">&#40;</span>Zend_Db_Profiler::<span style="color: #006600;">SELECT</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// SELECT、INSERT そして UPDATE クエリを調べます</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$profiler</span>-&gt;<span style="color: #006600;">setFilterQueryType</span><span style="color: #66cc66;">&#40;</span>Zend_Db_Profiler::<span style="color: #006600;">SELECT</span> |</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Zend_Db_Profiler::<span style="color: #006600;">INSERT</span> |</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Zend_Db_Profiler::<span style="color: #006600;">UPDATE</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// DELETE クエリを調べます</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$profiler</span>-&gt;<span style="color: #006600;">setFilterQueryType</span><span style="color: #66cc66;">&#40;</span>Zend_Db_Profiler::<span style="color: #006600;">DELETE</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// すべてのフィルタを削除します</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$profiler</span>-&gt;<span style="color: #006600;">setFilterQueryType</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">null</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        </div>

        <div class="section" id="zend.db.profiler.advanced.getbytype" name="zend.db.profiler.advanced.getbytype"><div class="info"><h1 class="title">クエリの型を指定することによる情報の取得</h1></div>
            

            <p class="para">
                 <span class="methodname">setFilterQueryType()</span> を使用すると、
                生成される情報を減らすことができます。
                すべての情報を保持しておくほうがよい場合もありますが、
                普通はそのときに必要な情報のみが見られればよいでしょう。
                 <span class="methodname">getQueryProfiles()</span> のもうひとつの機能として、
                最初の引数にクエリの型 (あるいは複数の型の論理和)
                を指定することによるその場での絞り込みが可能です。
                クエリの型を表す定数については <a href="zend.db.profiler.html#zend.db.profiler.advanced.filtertype" class="link">この節</a>
                を参照ください。
            </p>

            <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// SELECT クエリの情報のみを取得します</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$profiles</span> = <span style="color: #0000ff;">$profiler</span>-&gt;<span style="color: #006600;">getQueryProfiles</span><span style="color: #66cc66;">&#40;</span>Zend_Db_Profiler::<span style="color: #006600;">SELECT</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// SELECT、INSERT そして UPDATE クエリの情報のみを取得します</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$profiles</span> = <span style="color: #0000ff;">$profiler</span>-&gt;<span style="color: #006600;">getQueryProfiles</span><span style="color: #66cc66;">&#40;</span>Zend_Db_Profiler::<span style="color: #006600;">SELECT</span> |</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Zend_Db_Profiler::<span style="color: #006600;">INSERT</span> |</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Zend_Db_Profiler::<span style="color: #006600;">UPDATE</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// DELETE クエリの情報を取得します</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$profiles</span> = <span style="color: #0000ff;">$profiler</span>-&gt;<span style="color: #006600;">getQueryProfiles</span><span style="color: #66cc66;">&#40;</span>Zend_Db_Profiler::<span style="color: #006600;">DELETE</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        </div>

    </div>

    <div class="section" id="zend.db.profiler.profilers" name="zend.db.profiler.profilers"><div class="info"><h1 class="title">特化型のプロファイラ</h1></div>
        

        <p class="para">
            特化型のプロファイラは <span class="classname">Zend_Db_Profiler</span>
            を継承したオブジェクトです。
            プロファイリング情報を特別な方法で処理します。
        </p>

        <div class="section" id="zend.db.profiler.profilers.firebug" name="zend.db.profiler.profilers.firebug"><div class="info"><h1 class="title">Firebug によるプロファイリング</h1></div>
    

    <p class="para">
        <span class="classname">Zend_Db_Profiler_Firebug</span> は、プロファイリング情報を
        <a href="http://www.getfirebug.com/" class="link external">&raquo; Firebug</a> <a href="http://getfirebug.com/logging.html" class="link external">&raquo; コンソール</a>
        に送信します。
    </p>

    <p class="para">
        すべてのデータの送信には <span class="classname">Zend_Wildfire_Channel_HttpHeaders</span>
        コンポーネントを使用します。これは <acronym class="acronym">HTTP</acronym> ヘッダを使用するので、
        ページのコンテンツには何も影響を及ぼしません。
        この方式なら、<acronym class="acronym">AJAX</acronym> リクエストのようにクリーンな <acronym class="acronym">JSON</acronym>
        および <acronym class="acronym">XML</acronym> レスポンスを要求するリクエストのデバッグも行えます。
    </p>

    <p class="para">
        要件:
    </p>

    <ul class="itemizedlist">
        <li class="listitem">
            <p class="para">
                Firefox ブラウザ。バージョン 3 が最適ですがバージョン 2 にも対応しています。
            </p>
        </li>

        <li class="listitem">
            <p class="para">
                Firebug 拡張。<a href="https://addons.mozilla.org/ja/firefox/addon/1843" class="link external">&raquo; https://addons.mozilla.org/ja/firefox/addon/1843</a>
                からダウンロードできます。
            </p>
        </li>

        <li class="listitem">
            <p class="para">
                FirePHP 拡張。<a href="https://addons.mozilla.org/ja/firefox/addon/6149" class="link external">&raquo; https://addons.mozilla.org/ja/firefox/addon/6149</a>
                からダウンロードできます。
            </p>
        </li>
    </ul>

    <div class="example"><div class="info"><p><b>Example #1 Zend_Controller_Front を使った DB のプロファイリング</b></p></div>
        

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// 起動ファイル</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$profiler</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_Db_Profiler_Firebug<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'All DB Queries'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$profiler</span>-&gt;<span style="color: #006600;">setEnabled</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// プロファイラを db アダプタにアタッチします</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$db</span>-&gt;<span style="color: #006600;">setProfiler</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$profiler</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// フロントコントローラをディスパッチします</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// モデル、ビューそしてコントローラファイル内で発行されたすべての</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// DB クエリのプロファイル結果が Firebug に送信されます</span></div></li></ol></div></div></div>

    </div>

    <div class="example"><div class="info"><p><b>Example #2 Zend_Controller_Front を使わない DB のプロファイリング</b></p></div>
        

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$profiler</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_Db_Profiler_Firebug<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'All DB Queries'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$profiler</span>-&gt;<span style="color: #006600;">setEnabled</span><span style="color: #66cc66;">&#40;</span><span style="color: #000000; font-weight: bold;">true</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// プロファイラを DB アダプタにアタッチします</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$db</span>-&gt;<span style="color: #006600;">setProfiler</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$profiler</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$request</span>&nbsp; = <span style="color: #000000; font-weight: bold;">new</span> Zend_Controller_Request_Http<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_Controller_Response_Http<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$channel</span>&nbsp; = Zend_Wildfire_Channel_HttpHeaders::<span style="color: #006600;">getInstance</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$channel</span>-&gt;<span style="color: #006600;">setRequest</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$request</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$channel</span>-&gt;<span style="color: #006600;">setResponse</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$response</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// 出力バッファリングを開始します</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/ob_start"><span style="color: #000066;">ob_start</span></a><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// DB クエリを発行すると、それがプロファイリングされます</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// データをブラウザに送信します</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$channel</span>-&gt;<span style="color: #006600;">flush</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$response</span>-&gt;<span style="color: #006600;">sendHeaders</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>

    </div>
</div>

    </div>
</div>
        <hr />

            <table width="100%">
                <tr>
                    <td width="25%" style="text-align: left;">
                    <a href="zend.db.statement.html">Zend_Db_Statement(日本語)</a>
                    </td>

                    <td width="50%" style="text-align: center;">
                        <div class="up"><span class="up"><a href="zend.db.html">Zend_Db</a></span><br />
                        <span class="home"><a href="manual.html">Programmer's Reference Guide</a></span></div>
                    </td>

                    <td width="25%" style="text-align: right;">
                        <div class="next" style="text-align: right; float: right;"><a href="zend.db.select.html">Zend_Db_Select(日本語)</a></div>
                    </td>
                </tr>
            </table>
</td>
        <td style="font-size: smaller;" width="15%"> <style type="text/css">
#leftbar {
	float: left;
	width: 186px;
	padding: 5px;
	font-size: smaller;
}
ul.toc {
	margin: 0px 5px 5px 5px;
	padding: 0px;
}
ul.toc li {
	font-size: 85%;
	margin: 1px 0 1px 1px;
	padding: 1px 0 1px 11px;
	list-style-type: none;
	background-repeat: no-repeat;
	background-position: center left;
}
ul.toc li.header {
	font-size: 115%;
	padding: 5px 0px 5px 11px;
	border-bottom: 1px solid #cccccc;
	margin-bottom: 5px;
}
ul.toc li.active {
	font-weight: bold;
}
ul.toc li a {
	text-decoration: none;
}
ul.toc li a:hover {
	text-decoration: underline;
}
</style>
 <ul class="toc">
  <li class="header home"><a href="manual.html">Programmer's Reference Guide</a></li>
  <li class="header up"><a href="manual.html">Programmer's Reference Guide</a></li>
  <li class="header up"><a href="reference.html">Zend Framework Reference</a></li>
  <li class="header up"><a href="zend.db.html">Zend_Db</a></li>
  <li><a href="zend.db.adapter.html">Zend_Db_Adapter(日本語)</a></li>
  <li><a href="zend.db.statement.html">Zend_Db_Statement(日本語)</a></li>
  <li class="active"><a href="zend.db.profiler.html">Zend_Db_Profiler(日本語)</a></li>
  <li><a href="zend.db.select.html">Zend_Db_Select(日本語)</a></li>
  <li><a href="zend.db.table.html">Zend_Db_Table(日本語)</a></li>
  <li><a href="zend.db.table.row.html">Zend_Db_Table_Row(日本語)</a></li>
  <li><a href="zend.db.table.rowset.html">Zend_Db_Table_Rowset(日本語)</a></li>
  <li><a href="zend.db.table.relationships.html">導入</a></li>
  <li><a href="zend.db.table.definition.html">Zend_Db_Table_Definition(日本語)</a></li>
 </ul>
 </td>
    </tr>
</table>
</body>
</html>