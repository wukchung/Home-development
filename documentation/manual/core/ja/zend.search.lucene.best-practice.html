<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>ベストプラクティス - Zend Framework Manual</title>

</head>
<body>
<table width="100%">
    <tr valign="top">
        <td width="85%">
            <table width="100%">
                <tr>
                    <td width="25%" style="text-align: left;">
                    <a href="zend.search.lucene.advanced.html">応用</a>
                    </td>

                    <td width="50%" style="text-align: center;">
                        <div class="up"><span class="up"><a href="zend.search.lucene.html">Zend_Search_Lucene</a></span><br />
                        <span class="home"><a href="manual.html">Programmer's Reference Guide</a></span></div>
                    </td>

                    <td width="25%" style="text-align: right;">
                        <div class="next" style="text-align: right; float: right;"><a href="zend.serializer.html">Zend_Serializer</a></div>
                    </td>
                </tr>
            </table>
<hr />
<div id="zend.search.lucene.best-practice" class="section"><div class="info"><h1 class="title">ベストプラクティス</h1></div>
    

    <div class="section" id="zend.search.lucene.best-practice.field-names" name="zend.search.lucene.best-practice.field-names"><div class="info"><h1 class="title">フィールド名</h1></div>
        

        <p class="para">
            <span class="classname">Zend_Search_Lucene</span> では、フィールド名に関する制限は特にありません。
        </p>

        <p class="para">
            しかし、できれば &#039;<em class="emphasis">id</em>&#039;
            および &#039;<em class="emphasis">score</em>&#039; という名前は使用を控えるようにしましょう。
            これらを使用すると、<code class="code">QueryHit</code>
            のプロパティ名と区別しにくくなります。
        </p>

        <p class="para">
            <span class="classname">Zend_Search_Lucene_Search_QueryHit</span> のプロパティ
            <code class="code">id</code> と <code class="code">score</code> はそれぞれ、Lucene
            ドキュメントが内部で使用する ID、検索結果の
            <a href="zend.search.lucene.searching.html#zend.search.lucene.searching.results-scoring" class="link">スコア</a>
            を表します。もしドキュメントでこれらと同じ名前のフィールドを使っているのなら、
            そのフィールドにアクセスするには  <span class="methodname">getDocument()</span>
            メソッドを使う必要があります。

            <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$hits</span> = <span style="color: #0000ff;">$index</span>-&gt;<span style="color: #006600;">find</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$query</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #b1b100;">foreach</span> <span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$hits</span> <span style="color: #b1b100;">as</span> <span style="color: #0000ff;">$hit</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #808080; font-style: italic;">// 'title' フィールドを取得します</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #0000ff;">$title</span> = <span style="color: #0000ff;">$hit</span>-&gt;<span style="color: #006600;">title</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #808080; font-style: italic;">// 'contents' フィールドを取得します</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #0000ff;">$contents</span> = <span style="color: #0000ff;">$hit</span>-&gt;<span style="color: #006600;">contents</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #808080; font-style: italic;">// Lucene ドキュメントの内部 ID を取得します</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #0000ff;">$id</span> = <span style="color: #0000ff;">$hit</span>-&gt;<span style="color: #006600;">id</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #808080; font-style: italic;">// 検索結果のスコアを取得します</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #0000ff;">$score</span> = <span style="color: #0000ff;">$hit</span>-&gt;<span style="color: #006600;">score</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #808080; font-style: italic;">// 'id' フィールドを取得します</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #0000ff;">$docId</span> = <span style="color: #0000ff;">$hit</span>-&gt;<span style="color: #006600;">getDocument</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>-&gt;<span style="color: #006600;">id</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #808080; font-style: italic;">// 'score' フィールドを取得します</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #0000ff;">$docId</span> = <span style="color: #0000ff;">$hit</span>-&gt;<span style="color: #006600;">getDocument</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>-&gt;<span style="color: #006600;">score</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #808080; font-style: italic;">// 'title' フィールドもこの方法で取得できます</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #0000ff;">$title</span> = <span style="color: #0000ff;">$hit</span>-&gt;<span style="color: #006600;">getDocument</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>-&gt;<span style="color: #006600;">title</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#125;</span></div></li></ol></div></div></div>

        </p>
    </div>

    <div class="section" id="zend.search.lucene.best-practice.indexing-performance" name="zend.search.lucene.best-practice.indexing-performance"><div class="info"><h1 class="title">インデックス作成のパフォーマンス</h1></div>
        

        <p class="para">
            インデックス作成のパフォーマンスは、
            リソースの消費量と所要時間、
            そしてインデックスの品質との兼ね合いで決まります。
        </p>

        <p class="para">
            インデックスの品質とは、要するにインデックスセグメントの数のことです。
        </p>

        <p class="para">
            各インデックスセグメントはデータ部とは独立しています。
            つまり、インデックスに含まれるセグメントが多くなればなるほど
            検索に要するメモリと時間は増加します。
        </p>

        <p class="para">
            インデックスの最適化を行うと、
            複数のセグメントをまとめて新しいひとつのセグメントを作成します。
            完全に最適化されたインデックスは、セグメントひとつだけで構成されます。
        </p>

        <p class="para">
            インデックスの最適化を行うには  <span class="methodname">optimize()</span> メソッドを使用します。
            <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$index</span> = Zend_Search_Lucene::<span style="color: #006600;">open</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$indexPath</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$index</span>-&gt;<span style="color: #006600;">optimize</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>

        </p>

        <p class="para">
            インデックスの最適化はデータストリーム上で行われるので、
            それほどメモリは消費しません。ただ、CPU
            リソースをかなり消費し、時間もかかります。
        </p>

        <p class="para">
            Lucene のインデックスセグメントは、その性質上
            更新はできません (更新するには、
            セグメントファイルを新たに作りなおす必要があります)。
            したがって、新しいドキュメントがインデックスに追加されるたびに
            新しいセグメントが作成されることになります。
            その結果、インデックスの品質は下がっていきます。
        </p>

        <p class="para">
            セグメントが作成されるたびにインデックスの自動最適化が行われ、
            一部のセグメントは自動的にマージされます。
        </p>

        <p class="para">
            自動最適化の設定は、次の 3 つのオプションで変更できます
            (<a href="zend.search.lucene.index-creation.html#zend.search.lucene.index-creation.optimization" class="link">インデックスの最適化</a>
            を参照ください)。
            <ul class="itemizedlist">
                <li class="listitem">
                    <p class="para"><em class="emphasis">MaxBufferedDocs</em>
                          は、メモリ内のバッファに保持されるドキュメントの最大数です。
                          この数を超えると、新しいセグメントを作成して
                          ハードディスクに書き込みます。</p>
                </li>
                <li class="listitem">
                    <p class="para"><em class="emphasis">MaxMergeDocs</em>
                          は、自動最適化によって新しいセグメントへのマージを行う基準となる
                          ドキュメント数です。</p>
                </li>
                <li class="listitem">
                    <p class="para"><em class="emphasis">MergeFactor</em>
                          は、自動最適化を行う頻度を指定します。</p>
                </li>
            </ul>
            <blockquote><p><b class="note">Note</b>: 
                
                    これらのオプションはすべて <span class="classname">Zend_Search_Lucene</span>
                    オブジェクトのプロパティであり、インデックスのプロパティではありません。
                    したがって、この設定は現在使用中の
                    <span class="classname">Zend_Search_Lucene</span> オブジェクトに対してのみ働くようになり、
                    スクリプトによって設定は異なります。
                <br />
            </p></blockquote>
        </p>

        <p class="para">
            <em class="emphasis">MaxBufferedDocs</em> は、
            スクリプトを一回実行するたびにひとつのドキュメントしか扱わない場合は
            何の影響も及ぼしません。
            逆に、バッチ処理の場合にはこの設定が非常に重要になります。
            値を大きくするとインデックス作成の速度が上がりますが、
            同時に大量のメモリを消費するようになります。
        </p>

        <p class="para">
            <em class="emphasis">MaxBufferedDocs</em>
            パラメータの値として最適なものを計算する公式はありません。
            これはドキュメントのサイズや解析器、使用できるメモリ量などに依存するからです。
        </p>

        <p class="para">
            最適な設定値を取得するには、
            扱うであろうドキュメントの中で最もサイズが大きいものを用いて
            何度かテストをしてみましょう
            <a href="#fnid1" name="fn1"><sup>[1]</sup></a>
              
                 <span class="methodname">memory_get_usage()</span> <span class="methodname">memory_get_peak_usage()</span>
            。
            使用可能なメモリのうち半分を超えない程度のメモリ消費量に抑えておくことをお勧めします。
        </p>

        <p class="para">
            <em class="emphasis">MaxMergeDocs</em> はセグメントの大きさ
            (これはドキュメントの大きさによって決まります) を制限します。
            これにより、自動最適化の時間を短縮できます。
            つまり、 <span class="methodname">addDocument()</span> メソッドが
            ある時間以上は実行されなくなります。
            これは、対話的なアプリケーションで重要になります。
        </p>

        <p class="para">
            <em class="emphasis">MaxMergeDocs</em> の設定値を小さくすると、
            バッチ処理のパフォーマンスもあがります。
            インデックスの自動最適化は対話的な処理であり、
            ひとつひとつ順を追って実行していきます。
            小さなセグメントたちがひとつの大きなセグメントにまとめられ、
            さらにまたそれが他のセグメントとまとまってより大きなセグメントになり、
            といった具合です。インデックスの最適化を完全に行うと、
            処理が非常に効率的になります。
        </p>

        <p class="para">
            セグメントのサイズを小さくするとインデックスの品質が下がり、
            大量のセグメントができあがってしまいます。場合によっては、OS
            の制限に引っかかって &quot;オープンしているファイルが多すぎる&quot;
            というエラーが発生するかもしれません
            <a href="#fnid2" name="fn2"><sup>[2]</sup></a>
              
                <span class="classname">Zend_Search_Lucene</span>
            。
        </p>

        <p class="para">
            したがって、バックグラウンドでのインデックスの最適化は対話モードで行い、
            バッチ処理用の <em class="emphasis">MaxMergeDocs</em>
            はあまり小さくしすぎないようにしなければなりません。
        </p>

        <p class="para">
            <em class="emphasis">MergeFactor</em> は自動最適化の頻度に影響を及ぼします。
            値を小さくすると、最適化されていないインデックスの品質が上がります。
            値を大きくするとインデックス作成の策度が上がりますが、
            セグメントの数も増えます。何度も言いますが、これは
            &quot;オープンしているファイルが多すぎる&quot; エラーの原因となりえます。
        </p>

        <p class="para">
            <em class="emphasis">MergeFactor</em> は、以下の条件を満たす大きさで
            インデックスセグメントをグループ化します。
            <ol type="1">
                <li class="listitem"><p class="para"><em class="emphasis">MaxBufferedDocs</em> 以下</p></li>
                <li class="listitem"><p class="para"><em class="emphasis">MaxBufferedDocs</em> より大きいが
                                <em class="emphasis">MaxBufferedDocs</em>*<em class="emphasis">MergeFactor</em> を超えない</p></li>
                <li class="listitem"><p class="para"><em class="emphasis">MaxBufferedDocs</em>*<em class="emphasis">MergeFactor</em> より大きいが
                <em class="emphasis">MaxBufferedDocs</em>*<em class="emphasis">MergeFactor</em>*<em class="emphasis">MergeFactor</em> を超えない</p></li>
                <li class="listitem"><p class="para">...</p></li>
            </ol>
        </p>

        <p class="para">
            Zend_Search_Lucene は、 <span class="methodname">addDocument()</span>
            をコールするたびにセグメントの状況を調べ、
            いくつかのセグメントをまとめて次のグループの新しいセグメントに移動できるかどうかを確認します。
            できる場合はマージを行います。
        </p>

        <p class="para">
            つまり、N 個のグループからなるインデックスには <em class="emphasis">MaxBufferedDocs</em> + (N-1)*<em class="emphasis">MergeFactor</em>
            のセグメントが含まれ、少なくとも
            <em class="emphasis">MaxBufferedDocs</em>*<em class="emphasis">MergeFactor</em><sup class="superscript">(N-1)</sup>
            のドキュメントが存在することになります。
        </p>

        <p class="para">
            この式で、インデックス内のセグメントの概数を求めることができます。
        </p>
        <p class="para">
            <em class="emphasis">NumberOfSegments</em> &lt;= <em class="emphasis">MaxBufferedDocs</em> + <em class="emphasis">MergeFactor</em>*log
            <sub class="subscript"><em class="emphasis">MergeFactor</em></sub> (<em class="emphasis">NumberOfDocuments</em>/<em class="emphasis">MaxBufferedDocs</em>)
        </p>

        <p class="para">
            <em class="emphasis">MaxBufferedDocs</em> は、使用できるメモリ量によって決まります。
            MergeFactor を適切に設定することで、セグメントの数を調整できます。
        </p>

        <p class="para">
            バッチ処理においては、<em class="emphasis">MergeFactor</em>
            パラメータを調整するほうが <em class="emphasis">MaxMergeDocs</em>
            を調整するよりも効率的です。しかし、微調整はできず大雑把なものとなります。
            そこで、まず上の公式をもとに <em class="emphasis">MergeFactor</em> を調整し、
            それから <em class="emphasis">MaxMergeDocs</em> を微調整してパフォーマンスを最適化しましょう。
        </p>
    </div>

    <div class="section" id="zend.search.lucene.best-practice.shutting-down" name="zend.search.lucene.best-practice.shutting-down"><div class="info"><h1 class="title">インデックスの終了時処理</h1></div>
        

        <p class="para">
            <span class="classname">Zend_Search_Lucene</span> オブジェクトは、
            終了時にちょっとした作業を行います。
            これは、インデックスにドキュメントが追加されたけれども
            新しいセグメントに書き込まれていないという場合に行われます。
        </p>

        <p class="para">
            また、場合によっては自動最適化も行います。
        </p>

        <p class="para">
            インデックスオブジェクトは、自分自身および QueryHit
            オブジェクトがすべてスコープ外に出た時点で自動的に終了処理を行います。
        </p>

        <p class="para">
            インデックスオブジェクトがグローバル変数に格納されている場合は、
            スクリプトの終了時に破棄されます
            <a href="#fnid3" name="fn3"><sup>[3]</sup></a>
              
            。
        </p>

        <p class="para">
            <acronym class="acronym">PHP</acronym> の例外処理もここで終了します。
        </p>

        <p class="para">
            これは通常のインデックス終了処理を妨げることはありませんが、
            何かエラーが発生した際に正しいエラー情報を取得できなくなる可能性があります。
        </p>

        <p class="para">
            この問題を回避する方法はふたつあります。
        </p>

        <p class="para">
            まずは、強制的にスコープ外に出す方法です。
            <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$index</span> = Zend_Search_Lucene::<span style="color: #006600;">open</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$indexPath</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">...</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/unset"><span style="color: #000066;">unset</span></a><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$index</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>

        </p>

        <p class="para">
            そしてもうひとつは、スクリプトの終了前にコミット操作を行うことです。
            <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$index</span> = Zend_Search_Lucene::<span style="color: #006600;">open</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$indexPath</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$index</span>-&gt;<span style="color: #006600;">commit</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>

            これについては、このドキュメントの
            &quot;<a href="zend.search.lucene.advanced.html#zend.search.lucene.advanced.static" class="link">応用: 静的プロパティとしてのインデックスの使用</a>&quot;
            でも説明しています。
        </p>
    </div>

    <div class="section" id="zend.search.lucene.best-practice.unique-id" name="zend.search.lucene.best-practice.unique-id"><div class="info"><h1 class="title">一意な ID によるドキュメントの取得</h1></div>
        

        <p class="para">
            ドキュメントの一意な ID、たとえば URL やパス、データベース上の ID
            などをインデックスに保存しておくとよいでしょう。
        </p>

        <p class="para">
            <span class="classname">Zend_Search_Lucene</span> には  <span class="methodname">termDocs()</span>
            というメソッドがあり、指定した単語を含むドキュメントを取得できます。
        </p>

        <p class="para">
            これは  <span class="methodname">find()</span> メソッドよりも効率的です。
            <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// find() メソッドでクエリ文字列を指定することによるドキュメントの取得</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$query</span> = <span style="color: #0000ff;">$idFieldName</span> . <span style="color: #ff0000;">':'</span> . <span style="color: #0000ff;">$docId</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$hits</span>&nbsp; = <span style="color: #0000ff;">$index</span>-&gt;<span style="color: #006600;">find</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$query</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #b1b100;">foreach</span> <span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$hits</span> <span style="color: #b1b100;">as</span> <span style="color: #0000ff;">$hit</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #0000ff;">$title</span>&nbsp; &nbsp; = <span style="color: #0000ff;">$hit</span>-&gt;<span style="color: #006600;">title</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #0000ff;">$contents</span> = <span style="color: #0000ff;">$hit</span>-&gt;<span style="color: #006600;">contents</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; ...</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">...</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// find() メソッドでクエリ API を使用することによるドキュメントの取得</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$term</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_Search_Lucene_Index_Term<span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$docId</span>, <span style="color: #0000ff;">$idFieldName</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$query</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_Search_Lucene_Search_Query_Term<span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$term</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$hits</span>&nbsp; = <span style="color: #0000ff;">$index</span>-&gt;<span style="color: #006600;">find</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$query</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #b1b100;">foreach</span> <span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$hits</span> <span style="color: #b1b100;">as</span> <span style="color: #0000ff;">$hit</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #0000ff;">$title</span>&nbsp; &nbsp; = <span style="color: #0000ff;">$hit</span>-&gt;<span style="color: #006600;">title</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #0000ff;">$contents</span> = <span style="color: #0000ff;">$hit</span>-&gt;<span style="color: #006600;">contents</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; ...</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">...</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #808080; font-style: italic;">// termDocs() メソッドによるドキュメントの取得</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$term</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_Search_Lucene_Index_Term<span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$docId</span>, <span style="color: #0000ff;">$idFieldName</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$docIds</span>&nbsp; = <span style="color: #0000ff;">$index</span>-&gt;<span style="color: #006600;">termDocs</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$term</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #b1b100;">foreach</span> <span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$docIds</span> <span style="color: #b1b100;">as</span> <span style="color: #0000ff;">$id</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #0000ff;">$doc</span> = <span style="color: #0000ff;">$index</span>-&gt;<span style="color: #006600;">getDocument</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$id</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #0000ff;">$title</span>&nbsp; &nbsp; = <span style="color: #0000ff;">$doc</span>-&gt;<span style="color: #006600;">title</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #0000ff;">$contents</span> = <span style="color: #0000ff;">$doc</span>-&gt;<span style="color: #006600;">contents</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; ...</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#125;</span></div></li></ol></div></div></div>

        </p>
    </div>

    <div class="section" id="zend.search.lucene.best-practice.memory-usage" name="zend.search.lucene.best-practice.memory-usage"><div class="info"><h1 class="title">メモリの使用法</h1></div>
        

        <p class="para">
            <span class="classname">Zend_Search_Lucene</span> は、比較的メモリを消費するモジュールです。
        </p>

        <p class="para">
            各種の情報をキャッシュしたり、検索やインデックス作成の速度を上げたりするために、メモリを使用しています。
        </p>

        <p class="para">
            メモリに関する挙動は、モードによって異なります。
        </p>

        <p class="para">
            単語辞書のインデックスは、検索時にメモリに読み込まれます。
            これは、実際の辞書に登録されている単語が 128件
            <a href="#fnid4" name="fn4"><sup>[4]</sup></a><span class="classname">Zend_Search_Lucene</span><acronym class="acronym">API</acronym>
            に達するごとに作成されます。
        </p>

        <p class="para">
            したがって、単語の数が増えれば増えるほどメモリの消費量も増加します。
            トークン化していないフレーズをフィールドの値として使用したり、
            テキスト以外の情報を大量にインデックスとして使用したりすると、
            単語の数が増えることになります。
        </p>

        <p class="para">
            最適化されていないインデックスは、複数のセグメントで構成されます。
            これも、メモリ消費量の増加の要因となります。
            各セグメントは独立しているので、それぞれ独自に単語辞書と辞書インデックスを持っています。
            ひとつのインデックスの中に <em class="emphasis">N</em> 個のセグメントがあったとすると、
            メモリの消費量は最悪で <em class="emphasis">N</em> 倍になってしまいます。
            インデックスの最適化を行ない、セグメントをひとつにまとめましょう。
        </p>

        <p class="para">
            インデックスは、検索処理とドキュメントのバッファリングに同じメモリを使用します。
            このメモリの使用量は、パラメータ <em class="emphasis">MaxBufferedDocs</em>
            で指定します。
        </p>

        <p class="para">
            インデックスの最適化 (完全最適化、部分最適化の両方)
            はストリーム上で行なわれるので、あまりメモリを消費しません。
        </p>
    </div>

    <div class="section" id="zend.search.lucene.best-practice.encoding" name="zend.search.lucene.best-practice.encoding"><div class="info"><h1 class="title">エンコーディング</h1></div>
        

        <p class="para">
            <span class="classname">Zend_Search_Lucene</span> は、内部で UTF-8 文字列を使用しています。
            したがって、Zend_Search_Lucene が返す文字列は、すべて UTF-8
            でエンコードされています。
        </p>

        <p class="para">
            単なる <acronym class="acronym">ASCII</acronym> データのみを扱うのであればエンコーディングを気にする必要はありません。
            しかしそれ以外の場合は要注意です。
        </p>

        <p class="para">
            間違ったエンコーディングを使用すると、
            エンコーディングの変換時にエラーが発生したりデータを失ってしまったりする可能性があります。
        </p>

        <p class="para">
            <span class="classname">Zend_Search_Lucene</span> は、ドキュメントやクエリのエンコーディングとしてさまざまなものに対応しています。
        </p>

        <p class="para">
            フィールドを作成するメソッドで、エンコーディングをオプションのパラメータによって指定できます。
            <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$doc</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_Search_Lucene_Document<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$doc</span>-&gt;<span style="color: #006600;">addField</span><span style="color: #66cc66;">&#40;</span>Zend_Search_Lucene_Field::<span style="color: #006600;">Text</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'title'</span>,</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$title</span>,</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">'iso-8859-1'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$doc</span>-&gt;<span style="color: #006600;">addField</span><span style="color: #66cc66;">&#40;</span>Zend_Search_Lucene_Field::<span style="color: #006600;">UnStored</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'contents'</span>,</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$contents</span>,</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">'utf-8'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>

            エンコーディングの指定をはっきりさせるという意味で、これが最も良い方法です。
        </p>

        <p class="para">
            このエンコーディング指定を省略すると、現在のロケールをもとに判断を行ないます。
            ロケールの指定時に、言語だけでなく文字セットも指定できます。
            <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/setlocale"><span style="color: #000066;">setlocale</span></a><span style="color: #66cc66;">&#40;</span>LC_ALL, <span style="color: #ff0000;">'fr_FR'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">...</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/setlocale"><span style="color: #000066;">setlocale</span></a><span style="color: #66cc66;">&#40;</span>LC_ALL, <span style="color: #ff0000;">'de_DE.iso-8859-1'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">...</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/setlocale"><span style="color: #000066;">setlocale</span></a><span style="color: #66cc66;">&#40;</span>LC_ALL, <span style="color: #ff0000;">'ja_JP.UTF-8'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">...</div></li></ol></div></div></div>

        </p>

        <p class="para">
            クエリ文字列のエンコーディングも、同じ方式で指定します。
        </p>

        <p class="para">
            エンコーディングを何らかの方法で指定しなかった場合は、
            現在のロケールにもとづいて判断を行ないます。
        </p>

        <p class="para">
            検索の前にクエリのパースを行なう場合、
            エンコーディングはオプションのパラメータとして指定できます。
            <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$query</span> =</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; Zend_Search_Lucene_Search_QueryParser::<span style="color: #006600;">parse</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$queryStr</span>, <span style="color: #ff0000;">'iso-8859-5'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$hits</span> = <span style="color: #0000ff;">$index</span>-&gt;<span style="color: #006600;">find</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$query</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">...</div></li></ol></div></div></div>

        </p>

        <p class="para">
            デフォルトのエンコーディングを指定するには  <span class="methodname">setDefaultEncoding()</span>
            メソッドを使用します。
            <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">Zend_Search_Lucene_Search_QueryParser::<span style="color: #006600;">setDefaultEncoding</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'iso-8859-1'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$hits</span> = <span style="color: #0000ff;">$index</span>-&gt;<span style="color: #006600;">find</span><span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$queryStr</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">...</div></li></ol></div></div></div>

            空の文字列は、&#039;現在のロケール&#039; を意味します。
        </p>

        <p class="para">
            正しいエンコーディングを指定すれば、解析器はそれを正しく処理できます。
            実際の挙動は、使用する解析器によって異なります。詳細は
            <a href="zend.search.lucene.charset.html" class="link">文字セット</a>
            についての説明を参照ください。
        </p>
    </div>

    <div class="section" id="zend.search.lucene.best-practice.maintenance" name="zend.search.lucene.best-practice.maintenance"><div class="info"><h1 class="title">インデックスの保守</h1></div>
        

        <p class="para">
            まずはっきりさせておくべきなのは、<span class="classname">Zend_Search_Lucene</span> やその他の
            Lucene 実装は決して &quot;データベース&quot; ではないということです。
        </p>

        <p class="para">
            つまり、データを保存するものとして使用してはいけません。
            通常のデータベース管理システムのように、バックアップ/リストア
            やジャーナル処理、ログの記録、トランザクションといった機能は持っていません。
        </p>

        <p class="para">
            しかし、<span class="classname">Zend_Search_Lucene</span> はインデックスの一貫性を保持するための機能は持っています。
        </p>

        <p class="para">
            インデックスのバックアップ/リストアは、オフラインでインデックスフォルダをコピーすることで行ないます。
        </p>

        <p class="para">
            何らかの理由でインデックスが壊れてしまった場合は、
            インデックスをリストアするか再構築しなければなりません。
        </p>

        <p class="para">
            そこで、大きなインデックスは、どこかに手動でバックアップしておき、
            何かあったときに手動で復元できるようにしておきましょう。
            そうすれば、障害からの復旧にかかる時間が短縮できます。
        </p>

    </div>
<div class="footnote"><a name="fnid1" href="#fn1"><sup>[1]</sup></a><span class="para footnote">
                や 
                で、メモリの使用量を確認します。
              </span></div>
<div class="footnote"><a name="fnid2" href="#fn2"><sup>[2]</sup></a><span class="para footnote"> は、セグメントファイルをずっとオープンしたままにしておきます。
                これによって検索の効率を上げています。
              </span></div>
<div class="footnote"><a name="fnid3" href="#fn3"><sup>[3]</sup></a><span class="para footnote">
                インデックスや QueryHit オブジェクトが複合データ型から参照されている場合にもこれは起こりえます。
                たとえば、循環参照を含むオブジェクトはスクリプトの終了時まで破棄されません。
              </span></div>
<div class="footnote"><a name="fnid4" href="#fn4"><sup>[4]</sup></a><span class="para footnote">
                Lucene のファイルフォーマットでは、この件数を変更することもできます。しかし
                 の  ではそれをサポートしていません。
                別の Lucene 実装を使用してインデックスをサポートすれば、
                この値を変更することも可能です。
            </span></div>
</div>
        <hr />

            <table width="100%">
                <tr>
                    <td width="25%" style="text-align: left;">
                    <a href="zend.search.lucene.advanced.html">応用</a>
                    </td>

                    <td width="50%" style="text-align: center;">
                        <div class="up"><span class="up"><a href="zend.search.lucene.html">Zend_Search_Lucene</a></span><br />
                        <span class="home"><a href="manual.html">Programmer's Reference Guide</a></span></div>
                    </td>

                    <td width="25%" style="text-align: right;">
                        <div class="next" style="text-align: right; float: right;"><a href="zend.serializer.html">Zend_Serializer</a></div>
                    </td>
                </tr>
            </table>
</td>
        <td style="font-size: smaller;" width="15%"> <style type="text/css">
#leftbar {
	float: left;
	width: 186px;
	padding: 5px;
	font-size: smaller;
}
ul.toc {
	margin: 0px 5px 5px 5px;
	padding: 0px;
}
ul.toc li {
	font-size: 85%;
	margin: 1px 0 1px 1px;
	padding: 1px 0 1px 11px;
	list-style-type: none;
	background-repeat: no-repeat;
	background-position: center left;
}
ul.toc li.header {
	font-size: 115%;
	padding: 5px 0px 5px 11px;
	border-bottom: 1px solid #cccccc;
	margin-bottom: 5px;
}
ul.toc li.active {
	font-weight: bold;
}
ul.toc li a {
	text-decoration: none;
}
ul.toc li a:hover {
	text-decoration: underline;
}
</style>
 <ul class="toc">
  <li class="header home"><a href="manual.html">Programmer's Reference Guide</a></li>
  <li class="header up"><a href="manual.html">Programmer's Reference Guide</a></li>
  <li class="header up"><a href="reference.html">Zend Framework Reference</a></li>
  <li class="header up"><a href="zend.search.lucene.html">Zend_Search_Lucene</a></li>
  <li><a href="zend.search.lucene.overview.html">概要</a></li>
  <li><a href="zend.search.lucene.index-creation.html">インデックスの構築</a></li>
  <li><a href="zend.search.lucene.searching.html">インデックスの検索</a></li>
  <li><a href="zend.search.lucene.query-language.html">クエリ言語</a></li>
  <li><a href="zend.search.lucene.query-api.html">クエリ作成用の API</a></li>
  <li><a href="zend.search.lucene.charset.html">文字セット</a></li>
  <li><a href="zend.search.lucene.extending.html">拡張性</a></li>
  <li><a href="zend.search.lucene.java-lucene.html">Java Lucene との相互運用</a></li>
  <li><a href="zend.search.lucene.advanced.html">応用</a></li>
  <li class="active"><a href="zend.search.lucene.best-practice.html">ベストプラクティス</a></li>
 </ul>
 </td>
    </tr>
</table>
</body>
</html>