<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>Zend_TimeSync の動作 - Zend Framework Manual</title>

</head>
<body>
<table width="100%">
    <tr valign="top">
        <td width="85%">
            <table width="100%">
                <tr>
                    <td width="25%" style="text-align: left;">
                    <a href="zend.timesync.introduction.html">導入</a>
                    </td>

                    <td width="50%" style="text-align: center;">
                        <div class="up"><span class="up"><a href="zend.timesync.html">Zend_TimeSync</a></span><br />
                        <span class="home"><a href="manual.html">Programmer's Reference Guide</a></span></div>
                    </td>

                    <td width="25%" style="text-align: right;">
                        <div class="next" style="text-align: right; float: right;"><a href="zend.tool.html">Zend_Tool</a></div>
                    </td>
                </tr>
            </table>
<hr />
<div id="zend.timesync.working" class="section"><div class="info"><h1 class="title">Zend_TimeSync の動作</h1></div>

    

    <p class="para">
        <span class="classname">Zend_TimeSync</span> は、指定した任意の
        <em class="emphasis">NTP</em> タイムサーバあるいは
        <em class="emphasis">SNTP</em> タイムサーバから実際の時刻を返します。
        自動的に複数のサーバを処理することができ、シンプルなインターフェイスを提供します。
    </p>

    <blockquote><p><b class="note">Note</b>: 
        
            この章のすべてのサンプルでは、一般に公開されているタイムサーバのひとつを使用します。
            私たちは <em class="emphasis">0.europe.pool.ntp.org</em>
            を使用しますが、あなたの環境にあわせて最も近いタイムサーバを使うことをお勧めします。
            詳細は <a href="http://www.pool.ntp.org" class="link external">&raquo; http://www.pool.ntp.org</a>
            を参照ください。
        <br />
    </p></blockquote>

    <div class="section" id="zend.timesync.working.generic" name="zend.timesync.working.generic"><div class="info"><h1 class="title">一般的なタイムサーバへのリクエスト</h1></div>

        

        <p class="para">
            タイムサーバから時刻を取得するのはきわめて簡単です。
            単に時刻を取得したいタイムサーバを指定するだけでいいのです。
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$server</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_TimeSync<span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'0.pool.ntp.org'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/print"><span style="color: #000066;">print</span></a> <span style="color: #0000ff;">$server</span>-&gt;<span style="color: #006600;">getDate</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>-&gt;<span style="color: #006600;">getIso</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            このとき <span class="classname">Zend_TimeSync</span> の裏側では何が起こっているのでしょうか?
            まず、指定したサーバの構文をチェックします。つまり今回の例では、
            &#039;<em class="emphasis">0.pool.ntp.org</em>&#039; がタイムサーバのアドレスとして正しい形式かどうかを確認します。
            それから、 <span class="methodname">getDate()</span> をコールする際に実際にタイムサーバを設定し、
            そのサーバの時刻を返します。<span class="classname">Zend_TimeSync</span>
            は、スクリプトが動作しているサーバの時刻と返された時刻とを比較し、
            修正済みの時刻を表す <span class="classname">Zend_Date</span> オブジェクトを返します。
        </p>

        <p class="para">
            <span class="classname">Zend_Date</span> やそのメソッドについての詳細は
            <a href="zend.date.introduction.html" class="link"><span class="classname">Zend_Date</span></a>
            を参照ください。
        </p>

    </div>

    <div class="section" id="zend.timesync.working.multiple" name="zend.timesync.working.multiple"><div class="info"><h1 class="title">複数のタイムサーバ</h1></div>

        

        <p class="para">
            すべてのタイムサーバが常に使用可能で時刻を返してくれるとは限りません。
            たとえばメンテナンス中などの理由でサーバに到達できないこともありえます。
            タイムサーバから時刻を取得できなかった場合は、例外が発生します。
        </p>

        <p class="para">
            この問題への対策として、<span class="classname">Zend_TimeSync</span>
            では複数のタイムサーバを処理できるようになっており、
            ひとつのタイムサーバが使用できなくても代替サーバを使用できるようになっています。
            これを利用するには二通りの方法があります。
            インスタンスを作成する際にタイムサーバの配列を指定するか、
            後から  <span class="methodname">addServer()</span> メソッドでタイムサーバを追加するかのいずれかです。
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$server</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_TimeSync<span style="color: #66cc66;">&#40;</span><a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'0.pool.ntp.org'</span>,</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">'1.pool.ntp.org'</span>,</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">'2.pool.ntp.org'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$server</span>-&gt;<span style="color: #006600;">addServer</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'3.pool.ntp.org'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/print"><span style="color: #000066;">print</span></a> <span style="color: #0000ff;">$server</span>-&gt;<span style="color: #006600;">getDate</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>-&gt;<span style="color: #006600;">getIso</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            追加できるタイムサーバの数には制限はありません。
            あるタイムサーバへの接続に失敗すると、
            <span class="classname">Zend_TimeSync</span> はその次に指定されたタイムサーバへの接続を試みます。
        </p>

        <p class="para">
            タイムサーバは複数指定することをお勧めします。
            その場合は、タイムサーバに名前をつけなければなりません。
            名前は配列のキーで指定することもできますが、
            初期化やタイムサーバの追加の際に 2 番目のパラメータで指定することもできます。
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$server</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_TimeSync<span style="color: #66cc66;">&#40;</span><a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'generic'</span>&nbsp; =&gt; <span style="color: #ff0000;">'0.pool.ntp.org'</span>,</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">'fallback'</span> =&gt; <span style="color: #ff0000;">'1.pool.ntp.org'</span>,</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">'reserve'</span>&nbsp; =&gt; <span style="color: #ff0000;">'2.pool.ntp.org'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$server</span>-&gt;<span style="color: #006600;">addServer</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'3.pool.ntp.org'</span>, <span style="color: #ff0000;">'additional'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/print"><span style="color: #000066;">print</span></a> <span style="color: #0000ff;">$server</span>-&gt;<span style="color: #006600;">getDate</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>-&gt;<span style="color: #006600;">getIso</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            タイムサーバの名前を設定することで、
            特定のタイムサーバにリクエストを送ることができるようになります。
            その方法については本章の後半で説明します。
        </p>

    </div>

    <div class="section" id="zend.timesync.working.protocol" name="zend.timesync.working.protocol"><div class="info"><h1 class="title">タイムサーバのプロトコル</h1></div>

        

        <p class="para">
            タイムサーバにはさまざまな形式があります。
            公開されているタイムサーバのほとんどは、
            <em class="emphasis">NTP</em> プロトコルを使用するものです。
            しかし、それ以外のプロトコルを使用しているサーバもあります。
        </p>

        <p class="para">
            タイムサーバのアドレスに、適切なプロトコルを指定できます。
            <span class="classname">Zend_TimeSync</span> がサポートしているプロトコルは 2 種類で、
            デフォルトのプロトコルは <em class="emphasis">NTP</em> です。
            NTP しか使用しないのなら、先ほどまでの例のようにプロトコル指定を省略しても構いません。
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$server</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_TimeSync<span style="color: #66cc66;">&#40;</span><a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'generic'</span>&nbsp; =&gt; <span style="color: #ff0000;">'ntp:<span style="color: #000099; font-weight: bold;">\\</span>0.pool.ntp.org'</span>,</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">'fallback'</span> =&gt; <span style="color: #ff0000;">'ntp:<span style="color: #000099; font-weight: bold;">\\</span>1.pool.ntp.org'</span>,</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">'reserve'</span>&nbsp; =&gt; <span style="color: #ff0000;">'ntp:<span style="color: #000099; font-weight: bold;">\\</span>2.pool.ntp.org'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$server</span>-&gt;<span style="color: #006600;">addServer</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'sntp:<span style="color: #000099; font-weight: bold;">\\</span>internal.myserver.com'</span>, <span style="color: #ff0000;">'additional'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/print"><span style="color: #000066;">print</span></a> <span style="color: #0000ff;">$server</span>-&gt;<span style="color: #006600;">getDate</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>-&gt;<span style="color: #006600;">getIso</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            <span class="classname">Zend_TimeSync</span> は複数のタイムサーバを使用できます。
            特定のプロトコルだけでなく、個々のサーバに対して別のプロトコルも指定できるようになっています。
        </p>

    </div>

    <div class="section" id="zend.timesync.working.ports" name="zend.timesync.working.ports"><div class="info"><h1 class="title">タイムサーバのポートの指定</h1></div>

        

        <p class="para">
            ウェブにおけるさまざまな他のプロトコルと同様、<em class="emphasis">NTP</em> や
            <em class="emphasis">SNTP</em> にも標準のポート番号があります。
            NTP が使用するポートは <em class="emphasis">123</em> で、
            SNTP は <em class="emphasis">37</em> を使用します。
        </p>

        <p class="para">
            しかし、実際には使われているポートが違うこともあります。
            使用するポートは、サーバごとにアドレス内に指定できます。
            ポートを指定するには、アドレスに続けてその数字を指定します。
            ポートを指定しなかった場合は、<span class="classname">Zend_TimeSync</span> は標準のポートを使用します。
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$server</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_TimeSync<span style="color: #66cc66;">&#40;</span><a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'generic'</span>&nbsp; =&gt; <span style="color: #ff0000;">'ntp:<span style="color: #000099; font-weight: bold;">\\</span>0.pool.ntp.org:200'</span>,</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">'fallback'</span> =&gt; <span style="color: #ff0000;">'ntp:<span style="color: #000099; font-weight: bold;">\\</span>1.pool.ntp.org'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$server</span>-&gt;<span style="color: #006600;">addServer</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'sntp:<span style="color: #000099; font-weight: bold;">\\</span>internal.myserver.com:399'</span>, <span style="color: #ff0000;">'additional'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/print"><span style="color: #000066;">print</span></a> <span style="color: #0000ff;">$server</span>-&gt;<span style="color: #006600;">getDate</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>-&gt;<span style="color: #006600;">getIso</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


    </div>

    <div class="section" id="zend.timesync.working.options" name="zend.timesync.working.options"><div class="info"><h1 class="title">タイムサーバ用のオプション</h1></div>

        

        <p class="para">
            実際のところ <span class="classname">Zend_TimeSync</span> で使用するオプションはひとつだけで、
            それも内部的に使用するものです。しかし、必要に応じて任意のオプションを指定して
            リクエストを送信できます。
        </p>

        <p class="para">
            <em class="emphasis">timeout</em> オプションは、
            応答がない状態が何秒続けば接続に失敗したとみなすのかを表します。
            デフォルトの値は <em class="emphasis">1</em> で、
            タイムサーバからの応答が 1 秒以内に返ってこなかった場合に
            <span class="classname">Zend_TimeSync</span> は別のタイムサーバに処理を移します。
        </p>

        <p class="para">
             <span class="methodname">setOptions()</span> メソッドを使用すれば、任意のオプションを指定できます。
            このメソッドには、オプション名とその値を関連付けた配列を指定します。
            既に設定済みのオプションは、新しい値で上書きされます。
            どんなオプションが設定されているのかを知りたい場合は
             <span class="methodname">getOptions()</span> メソッドを使用します。
            このメソッドにキーを指定した場合はそのオプションの値を返します。
            指定しなかった場合は、すべてのオプションを返します。
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">Zend_TimeSync::<span style="color: #006600;">setOptions</span><span style="color: #66cc66;">&#40;</span><a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'timeout'</span> =&gt; <span style="color: #cc66cc;">3</span>, <span style="color: #ff0000;">'myoption'</span> =&gt; <span style="color: #ff0000;">'timesync'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$server</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_TimeSync<span style="color: #66cc66;">&#40;</span><a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'generic'</span>&nbsp; =&gt; <span style="color: #ff0000;">'ntp:<span style="color: #000099; font-weight: bold;">\\</span>0.pool.ntp.org'</span>,</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">'fallback'</span> =&gt; <span style="color: #ff0000;">'ntp:<span style="color: #000099; font-weight: bold;">\\</span>1.pool.ntp.org'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$server</span>-&gt;<span style="color: #006600;">addServer</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'sntp:<span style="color: #000099; font-weight: bold;">\\</span>internal.myserver.com'</span>, <span style="color: #ff0000;">'additional'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/print"><span style="color: #000066;">print</span></a> <span style="color: #0000ff;">$server</span>-&gt;<span style="color: #006600;">getDate</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>-&gt;<span style="color: #006600;">getIso</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/print_r"><span style="color: #000066;">print_r</span></a><span style="color: #66cc66;">&#40;</span>Zend_TimeSync::<span style="color: #006600;">getOptions</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/print"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;Timeout = &quot;</span> . Zend_TimeSync::<span style="color: #006600;">getOptions</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'timeout'</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            ご覧のとおり、<span class="classname">Zend_TimeSync</span> のオプションは静的なものです。
            つまり、すべての <span class="classname">Zend_TimeSync</span> のインスタンスで同じ設定が共用されます。
        </p>

    </div>

    <div class="section" id="zend.timesync.working.different" name="zend.timesync.working.different"><div class="info"><h1 class="title">別のタイムサーバの使用法</h1></div>

        

        <p class="para">
            時間を取得したい場合、デフォルトでは最初に指定したサーバにリクエストを送信します。
            しかし、別のタイムサーバを指定してリクエストしたほうが便利なこともあります。
            その場合は  <span class="methodname">setServer()</span> メソッドを使用します。
            使用するタイムサーバを指定するには、
            タイムサーバのエイリアスをこのメソッドのパラメータとして指定します。
            実際に使われるタイムサーバを知りたい場合は、単に
             <span class="methodname">getServer()</span> メソッドをコールします。
            タイムサーバのエイリアスを指定すると、そのタイムサーバを返します。
            パラメータを省略した場合は、現在のタイムサーバを返します。
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$server</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_TimeSync<span style="color: #66cc66;">&#40;</span><a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'generic'</span>&nbsp; =&gt; <span style="color: #ff0000;">'ntp:<span style="color: #000099; font-weight: bold;">\\</span>0.pool.ntp.org'</span>,</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">'fallback'</span> =&gt; <span style="color: #ff0000;">'ntp:<span style="color: #000099; font-weight: bold;">\\</span>1.pool.ntp.org'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$server</span>-&gt;<span style="color: #006600;">addServer</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'sntp:<span style="color: #000099; font-weight: bold;">\\</span>internal.myserver.com'</span>, <span style="color: #ff0000;">'additional'</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$actual</span> = <span style="color: #0000ff;">$server</span>-&gt;<span style="color: #006600;">getServer</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$server</span> = <span style="color: #0000ff;">$server</span>-&gt;<span style="color: #006600;">setServer</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'additional'</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


    </div>

    <div class="section" id="zend.timesync.working.informations" name="zend.timesync.working.informations"><div class="info"><h1 class="title">タイムサーバからの情報</h1></div>

        

        <p class="para">
            タイムサーバは、時刻以外にも付加情報を提供します。
            この情報を取得するには  <span class="methodname">getInfo()</span> メソッドを使用します。
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$server</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_TimeSync<span style="color: #66cc66;">&#40;</span><a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">'generic'</span>&nbsp; =&gt; <span style="color: #ff0000;">'ntp:<span style="color: #000099; font-weight: bold;">\\</span>0.pool.ntp.org'</span>,</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">'fallback'</span> =&gt; <span style="color: #ff0000;">'ntp:<span style="color: #000099; font-weight: bold;">\\</span>1.pool.ntp.org'</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><a href="http://www.php.net/print_r"><span style="color: #000066;">print_r</span></a> <span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$server</span>-&gt;<span style="color: #006600;">getInfo</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>;</div></li></ol></div></div></div>


        <p class="para">
            どのような情報が得られるのかは、
            使用しているプロトコルやサーバによってさまざまに異なります。
        </p>

    </div>

    <div class="section" id="zend.timesync.working.exceptions" name="zend.timesync.working.exceptions"><div class="info"><h1 class="title">例外処理</h1></div>

        

        <p class="para">
            すべてのタイムサーバで発生した例外は、ひとつの配列にまとめて返されます。
            発生した例外をすべて処理するには、次の例のようにします。
        </p>

        <div class="programlisting php"><div class="phpcode"><div class="php" style="font-family: monospace;"><ol><li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$serverlist</span> = <a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">&#40;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;">// 無効なサーバを指定します</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">'invalid_a'</span>&nbsp; =&gt; <span style="color: #ff0000;">'ntp://a.foo.bar.org'</span>,</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">'invalid_b'</span>&nbsp; =&gt; <span style="color: #ff0000;">'sntp://b.foo.bar.org'</span>,</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #0000ff;">$server</span> = <span style="color: #000000; font-weight: bold;">new</span> Zend_TimeSync<span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$serverlist</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">try <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #0000ff;">$result</span> = <span style="color: #0000ff;">$server</span>-&gt;<span style="color: #006600;">getDate</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <a href="http://www.php.net/echo"><span style="color: #000066;">echo</span></a> <span style="color: #0000ff;">$result</span>-&gt;<span style="color: #006600;">getIso</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#125;</span> catch <span style="color: #66cc66;">&#40;</span>Zend_TimeSync_Exception <span style="color: #0000ff;">$e</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #0000ff;">$exceptions</span> = <span style="color: #0000ff;">$e</span>-&gt;<span style="color: #006600;">get</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #b1b100;">foreach</span> <span style="color: #66cc66;">&#40;</span><span style="color: #0000ff;">$exceptions</span> <span style="color: #b1b100;">as</span> <span style="color: #0000ff;">$key</span> =&gt; <span style="color: #0000ff;">$myException</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <a href="http://www.php.net/echo"><span style="color: #000066;">echo</span></a> <span style="color: #0000ff;">$myException</span>-&gt;<span style="color: #006600;">getMessage</span><span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; &nbsp; &nbsp; <a href="http://www.php.net/echo"><span style="color: #000066;">echo</span></a> <span style="color: #ff0000;">'&lt;br /&gt;'</span>;</div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;">&nbsp; &nbsp; <span style="color: #66cc66;">&#125;</span></div></li>
<li style="font-family: 'Courier New', Courier, monospace; color: black; font-weight: normal; font-style: normal;"><div style="font-family: 'Courier New', Courier, monospace; font-weight: normal;"><span style="color: #66cc66;">&#125;</span></div></li></ol></div></div></div>

    </div>
</div>
        <hr />

            <table width="100%">
                <tr>
                    <td width="25%" style="text-align: left;">
                    <a href="zend.timesync.introduction.html">導入</a>
                    </td>

                    <td width="50%" style="text-align: center;">
                        <div class="up"><span class="up"><a href="zend.timesync.html">Zend_TimeSync</a></span><br />
                        <span class="home"><a href="manual.html">Programmer's Reference Guide</a></span></div>
                    </td>

                    <td width="25%" style="text-align: right;">
                        <div class="next" style="text-align: right; float: right;"><a href="zend.tool.html">Zend_Tool</a></div>
                    </td>
                </tr>
            </table>
</td>
        <td style="font-size: smaller;" width="15%"> <style type="text/css">
#leftbar {
	float: left;
	width: 186px;
	padding: 5px;
	font-size: smaller;
}
ul.toc {
	margin: 0px 5px 5px 5px;
	padding: 0px;
}
ul.toc li {
	font-size: 85%;
	margin: 1px 0 1px 1px;
	padding: 1px 0 1px 11px;
	list-style-type: none;
	background-repeat: no-repeat;
	background-position: center left;
}
ul.toc li.header {
	font-size: 115%;
	padding: 5px 0px 5px 11px;
	border-bottom: 1px solid #cccccc;
	margin-bottom: 5px;
}
ul.toc li.active {
	font-weight: bold;
}
ul.toc li a {
	text-decoration: none;
}
ul.toc li a:hover {
	text-decoration: underline;
}
</style>
 <ul class="toc">
  <li class="header home"><a href="manual.html">Programmer's Reference Guide</a></li>
  <li class="header up"><a href="manual.html">Programmer's Reference Guide</a></li>
  <li class="header up"><a href="reference.html">Zend Framework Reference</a></li>
  <li class="header up"><a href="zend.timesync.html">Zend_TimeSync</a></li>
  <li><a href="zend.timesync.introduction.html">導入</a></li>
  <li class="active"><a href="zend.timesync.working.html">Zend_TimeSync の動作</a></li>
 </ul>
 </td>
    </tr>
</table>
</body>
</html>